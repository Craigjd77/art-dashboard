<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Manager Dashboard | FRT Work Tools</title>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="style-switcher.css">
    
    <style>
        .client-hierarchy {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: var(--pbi-shadow);
        }
        
        .parent-client {
            font-size: 16px;
            font-weight: 600;
            color: var(--pbi-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .child-clients {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-left: 24px;
        }
        
        .child-client-badge {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }
        
        .child-client-badge:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
        }
        
        .child-client-badge.active {
            background: white;
            color: var(--pbi-primary);
            border-color: white;
            font-weight: 600;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .info-card {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            border-radius: 4px;
            padding: 12px;
            box-shadow: var(--pbi-shadow);
        }
        
        .info-card-label {
            font-size: 10px;
            color: var(--pbi-text-secondary);
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .info-card-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--pbi-text-primary);
        }
        
        .info-card-value.yes {
            color: var(--chart-green);
        }
        
        .info-card-value.no {
            color: var(--chart-red);
        }
        
        .open-items-section {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            border-left: 4px solid #ff8c00;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--pbi-shadow);
        }
        
        .open-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--pbi-border-light);
        }
        
        .open-item:last-child {
            border-bottom: none;
        }
        
        .open-item-left {
            flex: 1;
        }
        
        .open-item-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--pbi-text-primary);
            margin-bottom: 2px;
        }
        
        .open-item-desc {
            font-size: 10px;
            color: var(--pbi-text-secondary);
        }
        
        .open-item-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-jira {
            background: #0052CC;
            color: white;
        }
        
        .badge-ots {
            background: #ff8c00;
            color: white;
        }
        
        .badge-audit {
            background: #d13438;
            color: white;
        }
        
        .interaction-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--pbi-border-light);
        }
        
        .interaction-item:last-child {
            border-bottom: none;
        }
        
        .interaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .interaction-type {
            font-size: 11px;
            font-weight: 600;
            color: var(--pbi-text-primary);
        }
        
        .interaction-date {
            font-size: 9px;
            color: var(--pbi-text-secondary);
        }
        
        .interaction-details {
            font-size: 10px;
            color: var(--pbi-text-secondary);
        }
        
        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        
        .user-badge {
            background: var(--pbi-background);
            border: 1px solid var(--pbi-border);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .user-badge.admin {
            background: #e3f2fd;
            border-color: var(--pbi-primary);
            color: var(--pbi-primary);
        }
        
        .recovery-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--pbi-border-light);
        }
        
        .recovery-item:last-child {
            border-bottom: none;
        }
        
        .recovery-case {
            font-size: 11px;
            font-weight: 600;
            color: var(--pbi-text-primary);
        }
        
        .recovery-amount {
            font-size: 12px;
            font-weight: 600;
            color: var(--chart-green);
        }
        
        .recovery-date {
            font-size: 10px;
            color: var(--pbi-text-secondary);
        }
        
        .eligibility-snapshot {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }
        
        .eligibility-card {
            background: var(--pbi-background);
            border: 1px solid var(--pbi-border);
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }
        
        .eligibility-count {
            font-size: 24px;
            font-weight: 600;
            color: var(--pbi-primary);
            margin-bottom: 4px;
        }
        
        .eligibility-label {
            font-size: 10px;
            color: var(--pbi-text-secondary);
            text-transform: uppercase;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 1400px) {
            .grid-3 {
                grid-template-columns: 1fr;
            }
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Page Navigation */
        .page-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            padding: 8px;
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            border-radius: 4px;
            box-shadow: var(--pbi-shadow);
        }
        
        .page-nav-btn {
            padding: 6px 16px;
            border: 1px solid var(--pbi-border);
            background: var(--pbi-background);
            color: var(--pbi-text-primary);
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .page-nav-btn:hover {
            background: var(--pbi-hover);
            border-color: var(--pbi-primary);
        }
        
        .page-nav-btn.active {
            background: var(--pbi-primary);
            color: white;
            border-color: var(--pbi-primary);
        }
        
        .dashboard-page {
            display: none;
        }

        .dashboard-page.active {
            display: block !important;
        }
        
        /* Ensure chart containers are properly sized */
        .bar-chart-container {
            height: 280px !important;
            position: relative !important;
            width: 100% !important;
        }
        
        .bar-chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .donut-container {
            height: 280px !important;
            position: relative !important;
            width: 100% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .donut-container canvas {
            max-width: 100% !important;
            max-height: 100% !important;
        }
        
        .page-indicator {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
            color: var(--pbi-text-secondary);
        }
        
        .recovery-trend-period-btn {
            transition: all 0.2s ease;
        }
        
        .recovery-trend-period-btn:hover:not(.active) {
            background: var(--pbi-hover) !important;
            border-color: var(--pbi-primary) !important;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">FRT Work Tools</div>
            <div class="header-title">Account Manager Dashboard</div>
        </div>
        <div class="header-right">
            <div class="user-info">Craig D'Alessio</div>
            <button>Share</button>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <button class="nav-tab">
            <i class="fas fa-file-check"></i>
            ELIGIBILITY & FILINGS
        </button>
        <button class="nav-tab">
            <i class="fas fa-chart-line"></i>
            STATUS REPORTS
        </button>
        <button class="nav-tab">
            <i class="fas fa-bell"></i>
            OPT-IN MONITORING
        </button>
        <button class="nav-tab">
            <i class="fas fa-money-bill-wave"></i>
            REMITTANCE
        </button>
        <button class="nav-tab active">
            <i class="fas fa-user-tie"></i>
            Account Manager Dashboard
        </button>
        <button class="nav-tab">
            <i class="fas fa-users"></i>
            My Portfolio
        </button>
        <button class="nav-tab">+</button>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="client-selector">
                <label>Select a Client</label>
                <select id="clientSelect">
                    <option value="wellington">Wellington Management</option>
                    <option value="blackrock">BlackRock</option>
                    <option value="schwab">Charles Schwab Investment Management</option>
                </select>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Page Navigation -->
            <div class="page-nav">
                <button class="page-nav-btn active" onclick="showPage(1, this)">Page 1: Overview</button>
                <button class="page-nav-btn" onclick="showPage(2, this)">Page 2: Details</button>
                <div class="page-indicator">
                    <span id="currentPageIndicator">Page 1 of 2</span>
                </div>
            </div>

            <!-- Page 1: Overview -->
            <div class="dashboard-page active" id="page1">
                <!-- Client Header with Quick Actions -->
            <div class="viz-card" style="margin-bottom: 12px; background: linear-gradient(135deg, var(--pbi-primary) 0%, var(--pbi-primary-dark) 100%); color: white; padding: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <i class="fas fa-building" style="font-size: 24px;"></i>
                            <div>
                                <div style="font-size: 20px; font-weight: 700;" id="parentClientName">Wellington Management</div>
                                <div style="font-size: 11px; opacity: 0.9; margin-top: 2px;" id="clientSubtitle">Since 2020 • Strategic Partner</div>
                            </div>
                        </div>
                        <div class="child-clients" id="childClients" style="margin-top: 8px;">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s;" 
                                onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            <i class="fas fa-envelope" style="margin-right: 6px;"></i>Email
                        </button>
                        <button style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            <i class="fas fa-phone" style="margin-right: 6px;"></i>Call
                        </button>
                        <button style="background: white; border: none; color: var(--pbi-primary); padding: 8px 16px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                            <i class="fas fa-calendar-plus" style="margin-right: 6px;"></i>Schedule
                        </button>
                    </div>
                </div>
            </div>

            <!-- AM Priority Section - What Matters Most -->
            <div class="grid-3" style="margin-bottom: 12px;">
                <!-- Open Items - Most Important -->
                <div class="viz-card" style="border-left: 4px solid #ff8c00;">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-exclamation-triangle" style="color: #ff8c00; margin-right: 6px;"></i>Requires Attention</span>
                        <span class="badge" style="background: #ff8c00;">5 OPEN</span>
                    </div>
                    <div id="quickOpenItems">
                        <!-- Top 3 most urgent items -->
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--pbi-border-light);">
                        <a href="#open-items" style="font-size: 10px; color: var(--pbi-primary); text-decoration: none;">
                            View all open items <i class="fas fa-arrow-right" style="font-size: 8px;"></i>
                        </a>
                    </div>
                </div>

                <!-- Recent Interactions -->
                <div class="viz-card" style="border-left: 4px solid var(--pbi-primary);">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-comments" style="color: var(--pbi-primary); margin-right: 6px;"></i>Recent Interactions</span>
                        <span class="badge" style="background: var(--pbi-primary);">4 NEW</span>
                    </div>
                    <div id="quickInteractions">
                        <!-- Last 3 interactions -->
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--pbi-border-light);">
                        <a href="#interactions" style="font-size: 10px; color: var(--pbi-primary); text-decoration: none;">
                            View all interactions <i class="fas fa-arrow-right" style="font-size: 8px;"></i>
                        </a>
                    </div>
                </div>

                <!-- Upcoming & Notifications -->
                <div class="viz-card" style="border-left: 4px solid var(--chart-green);">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-bell" style="color: var(--chart-green); margin-right: 6px;"></i>Upcoming & Alerts</span>
                        <span class="badge" style="background: var(--chart-green);">3 NEW</span>
                    </div>
                    <div id="quickUpcoming">
                        <!-- Upcoming deadlines, new notifications -->
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--pbi-border-light);">
                        <a href="#notifications" style="font-size: 10px; color: var(--pbi-primary); text-decoration: none;">
                            View all notifications <i class="fas fa-arrow-right" style="font-size: 8px;"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics & Benchmarking -->
            <div class="grid-4" style="margin-bottom: 12px;">
                <div class="viz-card" style="border-left: 3px solid var(--pbi-primary); padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: var(--pbi-text-secondary); margin-bottom: 4px; text-transform: uppercase;">Recovery Rate</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--pbi-primary);" id="recoveryRate">18.4%</div>
                    <div style="font-size: 8px; color: var(--chart-green); margin-top: 2px;">
                        <i class="fas fa-arrow-up"></i> +2.3% vs avg
                    </div>
                </div>
                <div class="viz-card" style="border-left: 3px solid var(--chart-green); padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: var(--pbi-text-secondary); margin-bottom: 4px; text-transform: uppercase;">Filing Efficiency</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--chart-green);" id="filingEfficiency">94%</div>
                    <div style="font-size: 8px; color: var(--chart-green); margin-top: 2px;">
                        <i class="fas fa-check-circle"></i> Excellent
                    </div>
                </div>
                <div class="viz-card" style="border-left: 3px solid #ff8c00; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: var(--pbi-text-secondary); margin-bottom: 4px; text-transform: uppercase;">Avg Days to Recovery</div>
                    <div style="font-size: 24px; font-weight: 700; color: #ff8c00;" id="avgDaysToRecovery">127</div>
                    <div style="font-size: 8px; color: var(--chart-green); margin-top: 2px;">
                        <i class="fas fa-arrow-down"></i> 15 days faster
                    </div>
                </div>
                <div class="viz-card" style="border-left: 3px solid #8764b8; padding: 10px; text-align: center;">
                    <div style="font-size: 9px; color: var(--pbi-text-secondary); margin-bottom: 4px; text-transform: uppercase;">Client Satisfaction</div>
                    <div style="font-size: 24px; font-weight: 700; color: #8764b8;" id="clientSatisfaction">4.8/5</div>
                    <div style="font-size: 8px; color: var(--chart-green); margin-top: 2px;">
                        <i class="fas fa-star"></i> Top 10%
                    </div>
                </div>
            </div>

            <!-- Key Metrics - Flashy Cards -->
            <div class="grid-4" style="margin-bottom: 12px;">
                <div class="kpi-card-flashy" style="background: linear-gradient(135deg, var(--chart-green) 0%, #0d6b0d 100%); border: none; padding: 12px; text-align: center; color: white;">
                    <div style="font-size: 9px; color: rgba(255,255,255,0.9); margin-bottom: 4px; text-transform: uppercase;">Total Recoveries</div>
                    <div style="font-size: 28px; font-weight: 700; color: white; margin-bottom: 2px;" id="totalRecoveriesKPI">$8.4M</div>
                    <div style="font-size: 8px; color: rgba(255,255,255,0.8);">YTD</div>
                </div>
                <div class="kpi-card-flashy" style="background: linear-gradient(135deg, var(--pbi-primary) 0%, var(--pbi-primary-dark) 100%); border: none; padding: 12px; text-align: center; color: white;">
                    <div style="font-size: 9px; color: rgba(255,255,255,0.9); margin-bottom: 4px; text-transform: uppercase;">Claims Filed</div>
                    <div style="font-size: 28px; font-weight: 700; color: white; margin-bottom: 2px;" id="claimsFiledKPI">47</div>
                    <div style="font-size: 8px; color: rgba(255,255,255,0.8);">Active</div>
                </div>
                <div class="kpi-card-flashy" style="background: linear-gradient(135deg, #ff8c00 0%, #e67e00 100%); border: none; padding: 12px; text-align: center; color: white;">
                    <div style="font-size: 9px; color: rgba(255,255,255,0.9); margin-bottom: 4px; text-transform: uppercase;">Eligible Cases</div>
                    <div style="font-size: 28px; font-weight: 700; color: white; margin-bottom: 2px;" id="eligibleCasesKPI">32</div>
                    <div style="font-size: 8px; color: rgba(255,255,255,0.8);">Opportunities</div>
                </div>
                <div class="kpi-card-flashy" style="background: linear-gradient(135deg, #8764b8 0%, #6b4f9a 100%); border: none; padding: 12px; text-align: center; color: white;">
                    <div style="font-size: 9px; color: rgba(255,255,255,0.9); margin-bottom: 4px; text-transform: uppercase;">Expected Recovery</div>
                    <div style="font-size: 28px; font-weight: 700; color: white; margin-bottom: 2px;" id="expectedRecoveryKPI">$12.2M</div>
                    <div style="font-size: 8px; color: rgba(255,255,255,0.8);">Pipeline</div>
                </div>
            </div>

            <!-- Client Value & Health Section -->
            <div class="grid-2" style="margin-bottom: 12px; gap: 12px;">
                <!-- 9 Box Rating -->
                <div class="viz-card" style="border-left: 4px solid var(--pbi-primary);">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-th" style="color: var(--pbi-primary); margin-right: 6px;"></i>Client Value Matrix (9 Box)</span>
                        <span class="badge" id="nineBoxRating" style="background: var(--chart-green); font-size: 10px; padding: 4px 8px;">High Value / Low Cost</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 8px;">
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">High Cost</div>
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">Medium Cost</div>
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">Low Cost</div>
                    </div>
                    <div id="nineBoxGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; aspect-ratio: 1;">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-top: 4px;">
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">Low Value</div>
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">Medium Value</div>
                        <div style="text-align: center; font-size: 9px; color: var(--pbi-text-secondary); padding: 4px;">High Value</div>
                    </div>
                </div>

                <!-- Account Health & Quick Stats -->
                <div class="viz-card" style="border-left: 4px solid var(--chart-green);">
                    <div class="viz-title" style="margin-bottom: 12px;">
                        <i class="fas fa-heartbeat" style="color: var(--chart-green); margin-right: 6px;"></i>Account Health
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="flex: 1;">
                            <div style="font-size: 10px; color: var(--pbi-text-secondary); margin-bottom: 4px;">Overall Health Score</div>
                            <div style="font-size: 32px; font-weight: 700; color: var(--chart-green);" id="healthScore">85</div>
                            <div style="font-size: 9px; color: var(--pbi-text-secondary);">Excellent</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 10px; color: var(--pbi-text-secondary); margin-bottom: 4px;">Last Contact</div>
                            <div style="font-size: 14px; font-weight: 600;" id="lastContact">2 days ago</div>
                            <div style="font-size: 9px; color: var(--pbi-text-secondary);" id="lastContactType">Email</div>
                        </div>
                    </div>
                    <div class="info-grid" style="grid-template-columns: repeat(2, 1fr); gap: 8px; margin: 0;">
                        <div class="info-card" style="padding: 8px;">
                            <div class="info-card-label">Contract Value</div>
                            <div class="info-card-value" style="font-size: 12px; color: var(--chart-green);" id="contractValue">$2.4M</div>
                        </div>
                        <div class="info-card" style="padding: 8px;">
                            <div class="info-card-label">Renewal Date</div>
                            <div class="info-card-value" style="font-size: 12px;" id="renewalDate">3/15/2025</div>
                        </div>
                        <div class="info-card" style="padding: 8px;">
                            <div class="info-card-label">Engagement Level</div>
                            <div class="info-card-value" style="font-size: 12px; color: var(--chart-green);" id="engagementLevel">High</div>
                        </div>
                        <div class="info-card" style="padding: 8px;">
                            <div class="info-card-label">Churn Risk</div>
                            <div class="info-card-value" style="font-size: 12px; color: var(--chart-green);" id="churnRisk">Low</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Client Information -->
            <div class="viz-card" style="margin-bottom: 12px;">
                <div class="viz-title">Client Information</div>
                <div class="info-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 0;">
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Contract Date</div>
                        <div class="info-card-value" style="font-size: 12px;" id="contractDate">3/15/2020</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">ATF Signature</div>
                        <div class="info-card-value" style="font-size: 12px;" id="atfSignatureDate">3/22/2020</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Data Source</div>
                        <div class="info-card-value" style="font-size: 12px;" id="dataSource">Custodian Direct</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Refresh Frequency</div>
                        <div class="info-card-value" style="font-size: 12px;" id="dataRefresh">Monthly</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">CUSIP Client</div>
                        <div class="info-card-value yes" style="font-size: 12px;" id="cusipClient">Yes</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Recognized Loss</div>
                        <div class="info-card-value" style="font-size: 12px;" id="recognizedLoss">$45.8M</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Primary Contact</div>
                        <div class="info-card-value" style="font-size: 12px;" id="primaryContact">Sarah Johnson</div>
                    </div>
                    <div class="info-card" style="padding: 10px;">
                        <div class="info-card-label">Account Manager</div>
                        <div class="info-card-value" style="font-size: 12px;" id="accountManager">Craig D'Alessio</div>
                    </div>
                </div>
            </div>

            <!-- Relationship Timeline & Insights -->
            <div class="grid-2" style="margin-bottom: 12px; gap: 12px;">
                <!-- Relationship Timeline -->
                <div class="viz-card" style="border-left: 4px solid var(--pbi-primary);">
                    <div class="viz-title" style="margin-bottom: 12px;">
                        <i class="fas fa-history" style="color: var(--pbi-primary); margin-right: 6px;"></i>Relationship Timeline
                    </div>
                    <div id="relationshipTimeline" style="position: relative; padding-left: 24px;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Engagement Heatmap -->
                <div class="viz-card" style="border-left: 4px solid var(--chart-green);">
                    <div class="viz-title" style="margin-bottom: 12px;">
                        <i class="fas fa-calendar-alt" style="color: var(--chart-green); margin-right: 6px;"></i>Engagement Activity (Last 90 Days)
                    </div>
                    <div id="engagementHeatmap" style="display: grid; grid-template-columns: repeat(13, 1fr); gap: 4px;">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 9px; color: var(--pbi-text-secondary);">
                        <span>90 days ago</span>
                        <span>Today</span>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid-2" style="margin-bottom: 12px;">
                <!-- Recovery Trend Chart -->
                <div class="viz-card">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span>Recovery Trend Over Time</span>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <button class="recovery-trend-period-btn active" data-period="1" style="padding: 4px 10px; font-size: 9px; border: 1px solid var(--pbi-border); background: var(--pbi-primary); color: white; border-radius: 2px; cursor: pointer; font-weight: 500;">1 Year</button>
                            <button class="recovery-trend-period-btn" data-period="2" style="padding: 4px 10px; font-size: 9px; border: 1px solid var(--pbi-border); background: var(--pbi-card-bg); color: var(--pbi-text-primary); border-radius: 2px; cursor: pointer; font-weight: 500;">2 Years</button>
                            <button class="recovery-trend-period-btn" data-period="3" style="padding: 4px 10px; font-size: 9px; border: 1px solid var(--pbi-border); background: var(--pbi-card-bg); color: var(--pbi-text-primary); border-radius: 2px; cursor: pointer; font-weight: 500;">3 Years</button>
                            <button class="recovery-trend-period-btn" data-period="all" style="padding: 4px 10px; font-size: 9px; border: 1px solid var(--pbi-border); background: var(--pbi-card-bg); color: var(--pbi-text-primary); border-radius: 2px; cursor: pointer; font-weight: 500;">All Time</button>
                        </div>
                    </div>
                    <div class="bar-chart-container" style="height: 280px;">
                        <canvas id="recoveryTrendChart"></canvas>
                    </div>
                </div>

                <!-- Case Status Distribution -->
                <div class="viz-card">
                    <div class="viz-title">Case Status Distribution</div>
                    <div class="donut-container" style="height: 280px;">
                        <canvas id="caseStatusChart"></canvas>
                        <div class="donut-center">
                            <div class="donut-total" style="font-size: 20px;">47</div>
                            <div class="donut-label" style="font-size: 10px;">Total Cases</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recovery by Account -->
            <div class="viz-card" style="margin-bottom: 12px;">
                <div class="viz-title">Recovery by Child Account</div>
                <div class="bar-chart-container" style="height: 250px;">
                    <canvas id="recoveryByAccountChart"></canvas>
                </div>
            </div>

            <!-- Smart Action Center - AI-Powered Insights (Moved to Bottom) -->
            <div class="grid-2" style="margin-bottom: 12px; gap: 12px; margin-top: 20px;">
                <!-- Predictive Insights & Recommendations -->
                <div class="viz-card" style="border-left: 4px solid #8764b8; background: linear-gradient(135deg, rgba(135, 100, 184, 0.05) 0%, rgba(135, 100, 184, 0.02) 100%);">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-brain" style="color: #8764b8; margin-right: 6px;"></i>Smart Recommendations</span>
                        <span class="badge" style="background: #8764b8; font-size: 9px;">AI-Powered</span>
                    </div>
                    <div id="smartRecommendations">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Revenue Opportunities & Upsell -->
                <div class="viz-card" style="border-left: 4px solid var(--chart-green); background: linear-gradient(135deg, rgba(16, 124, 16, 0.05) 0%, rgba(16, 124, 16, 0.02) 100%);">
                    <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span><i class="fas fa-chart-line" style="color: var(--chart-green); margin-right: 6px;"></i>Revenue Opportunities</span>
                        <span class="badge" style="background: var(--chart-green); font-size: 9px;" id="opportunityValue">$1.2M Potential</span>
                    </div>
                    <div id="revenueOpportunities">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            </div>

            <!-- Page 2: Details -->
            <div class="dashboard-page" id="page2">
                <div class="viz-card" style="margin-bottom: 12px;">
                    <div class="viz-title">Client Details & Full Data</div>
                    <div style="font-size: 10px; color: var(--pbi-text-secondary); margin-bottom: 12px;">
                        Complete view of all client information, interactions, and recoveries
                    </div>
                </div>

                <!-- Two Column Layout -->
                <div class="grid-2">
                    <!-- Left Column -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- Open Items -->
                        <div class="open-items-section" id="open-items">
                        <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span><i class="fas fa-exclamation-circle" style="color: #ff8c00; margin-right: 8px;"></i>All Open Items</span>
                            <button class="export-button" onclick="exportTable('openItemsTable', 'Open_Items')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <div id="openItemsList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Recent Recoveries -->
                    <div class="viz-card">
                        <div class="viz-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span>Recent Recoveries</span>
                            <button class="export-button" onclick="exportTable('recoveriesTable', 'Recent_Recoveries')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                        <div id="recentRecoveriesList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- All Recoveries Summary -->
                    <div class="viz-card">
                        <div class="viz-title">All Recoveries Summary</div>
                        <div style="overflow-x: auto;">
                            <table class="data-table" id="allRecoveriesTable">
                                <thead>
                                    <tr>
                                        <th>Case Name</th>
                                        <th style="text-align: right;">Recovery Amount</th>
                                        <th>Date Received</th>
                                        <th>Child Account</th>
                                    </tr>
                                </thead>
                                <tbody id="allRecoveriesBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                                <tfoot>
                                    <tr style="background: var(--pbi-background); font-weight: 600;">
                                        <td>Total</td>
                                        <td style="text-align: right;" id="totalRecoveriesAmount">$8,420,000</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <!-- Recent Interactions -->
                    <div class="viz-card" id="interactions">
                        <div class="viz-title">All Recent Interactions</div>
                        <div id="recentInteractionsList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="viz-card" id="notifications">
                        <div class="viz-title">
                            All Notifications
                            <span class="badge" style="background: var(--pbi-primary); margin-left: 8px;">3 NEW</span>
                        </div>
                        <div id="notificationsList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Client Portal Users -->
                    <div class="viz-card">
                        <div class="viz-title">Client Portal Users</div>
                        <div class="user-list" id="portalUsersList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Notification Sign-ups -->
                    <div class="viz-card">
                        <div class="viz-title">Notification Sign-ups by User</div>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email Notifications</th>
                                        <th>Portal Notifications</th>
                                        <th>Last Active</th>
                                    </tr>
                                </thead>
                                <tbody id="notificationSignupsBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Style Switcher -->
    <script src="style-switcher.js?v=2"></script>

    <script>
        // Sample client data structure
        const clientData = {
            wellington: {
                parent: 'Wellington Management',
                children: [
                    { id: 'wellington-hf', name: 'Wellington Hedge Funds', active: true },
                    { id: 'wellington-mf', name: 'Wellington Mutual Funds', active: false },
                    { id: 'wellington-gf', name: 'Wellington Global Funds', active: false },
                    { id: 'wellington-tc', name: 'Wellington Trust Company', active: false }
                ],
                contractDate: '3/15/2020',
                atfSignatureDate: '3/22/2020',
                dataSource: 'Custodian Direct',
                dataRefresh: 'Monthly',
                cusipClient: true,
                recognizedLoss: '$45.8M',
                claimsFiled: 47,
                eligibleCases: 32,
                totalRecoveries: 8400000,
                expectedRecovery: 12200000,
                // New fields for account management
                nineBoxValue: 'high', // 'high', 'medium', 'low'
                nineBoxCost: 'low', // 'high', 'medium', 'low'
                healthScore: 85,
                lastContact: '2 days ago',
                lastContactType: 'Email',
                contractValue: '$2.4M',
                renewalDate: '3/15/2025',
                engagementLevel: 'High',
                churnRisk: 'Low',
                primaryContact: 'Sarah Johnson',
                accountManager: 'Craig D\'Alessio',
                clientSubtitle: 'Since 2020 • Strategic Partner',
                // Performance metrics
                recoveryRate: 18.4,
                filingEfficiency: 94,
                avgDaysToRecovery: 127,
                clientSatisfaction: 4.8,
                // Smart recommendations
                recommendations: [
                    { type: 'renewal', priority: 'high', title: 'Renewal Discussion', desc: 'Contract expires in 45 days - schedule renewal meeting', action: 'Schedule Meeting', value: '$2.4M' },
                    { type: 'upsell', priority: 'medium', title: 'Additional Services', desc: 'Client eligible for expanded coverage - $450K potential', action: 'Propose Upsell', value: '$450K' },
                    { type: 'engagement', priority: 'low', title: 'Quarterly Review', desc: 'Time for Q4 performance review - last one was 90 days ago', action: 'Schedule Review', value: null }
                ],
                revenueOpportunities: [
                    { type: 'new-cases', title: '15 New Eligible Cases', desc: 'Recently identified cases worth $1.2M potential recovery', value: '$1.2M', urgency: 'high' },
                    { type: 'expanded-coverage', title: 'Expanded Service Tier', desc: 'Upgrade to premium tier for additional case monitoring', value: '$180K ARR', urgency: 'medium' }
                ],
                relationshipTimeline: [
                    { date: '3/15/2020', event: 'Contract Signed', type: 'milestone', icon: 'fa-file-contract' },
                    { date: '6/20/2020', event: 'First Recovery Received', type: 'success', icon: 'fa-money-bill-wave' },
                    { date: '9/15/2021', event: 'Contract Renewal', type: 'milestone', icon: 'fa-sync' },
                    { date: '12/10/2022', event: 'Expanded Service Agreement', type: 'upsell', icon: 'fa-arrow-trend-up' },
                    { date: '3/20/2024', event: 'Second Renewal', type: 'milestone', icon: 'fa-sync' }
                ],
                engagementData: [
                    // Last 90 days of engagement (0-3 interactions per day)
                    0,1,0,2,1,0,0,1,3,2,1,0,1,2,1,0,0,1,2,3,1,0,1,1,2,0,0,1,2,1,
                    0,1,3,2,1,0,1,2,1,0,0,1,2,1,3,2,1,0,1,2,1,0,0,1,2,3,1,0,1,1,
                    2,0,0,1,2,1,0,1,3,2,1,0,1,2,1,0,0,1,2,1,3,2,1,0,1,2,1,0,0,1,
                    2,3,1,0,1,1,2,0,0,1,2,1,0,1,3,2,1,0,1,2,1
                ]
            },
            blackrock: {
                parent: 'BlackRock',
                children: [],
                contractDate: '1/10/2019',
                atfSignatureDate: '1/18/2019',
                dataSource: 'Custodian Direct',
                dataRefresh: 'Weekly',
                cusipClient: true,
                recognizedLoss: '$125.3M',
                claimsFiled: 89,
                eligibleCases: 67,
                totalRecoveries: 24500000,
                expectedRecovery: 35000000,
                nineBoxValue: 'high',
                nineBoxCost: 'medium',
                healthScore: 92,
                lastContact: '1 day ago',
                lastContactType: 'Phone Call',
                contractValue: '$5.8M',
                renewalDate: '1/10/2025',
                engagementLevel: 'Very High',
                churnRisk: 'Very Low',
                primaryContact: 'Michael Chen',
                accountManager: 'Craig D\'Alessio',
                clientSubtitle: 'Since 2019 • Premium Client',
                relationshipTimeline: [
                    { date: '1/10/2019', event: 'Contract Signed', type: 'milestone', icon: 'fa-file-contract' },
                    { date: '4/15/2019', event: 'First Recovery Received', type: 'success', icon: 'fa-money-bill-wave' },
                    { date: '1/10/2022', event: 'Contract Renewal', type: 'milestone', icon: 'fa-sync' },
                    { date: '6/20/2023', event: 'Expanded Service Agreement', type: 'upsell', icon: 'fa-arrow-trend-up' },
                    { date: '1/10/2024', event: 'Second Renewal', type: 'milestone', icon: 'fa-sync' }
                ],
                engagementData: Array(90).fill(0).map(() => Math.floor(Math.random() * 4))
            },
            schwab: {
                parent: 'Charles Schwab Investment Management',
                children: [],
                contractDate: '6/5/2021',
                atfSignatureDate: '6/12/2021',
                dataSource: 'Custodian Direct',
                dataRefresh: 'Monthly',
                cusipClient: false,
                recognizedLoss: '$28.7M',
                claimsFiled: 34,
                eligibleCases: 28,
                totalRecoveries: 4200000,
                expectedRecovery: 8500000,
                nineBoxValue: 'medium',
                nineBoxCost: 'low',
                healthScore: 78,
                lastContact: '5 days ago',
                lastContactType: 'Email',
                contractValue: '$1.2M',
                renewalDate: '6/5/2025',
                engagementLevel: 'Medium',
                churnRisk: 'Medium',
                primaryContact: 'Jennifer Williams',
                accountManager: 'Craig D\'Alessio',
                clientSubtitle: 'Since 2021 • Growth Client',
                relationshipTimeline: [
                    { date: '6/5/2021', event: 'Contract Signed', type: 'milestone', icon: 'fa-file-contract' },
                    { date: '9/20/2021', event: 'First Recovery Received', type: 'success', icon: 'fa-money-bill-wave' }
                ],
                engagementData: Array(90).fill(0).map(() => Math.floor(Math.random() * 3))
            }
        };

        // 9 Box grid positions: [row][col] where row=value (0=low, 1=medium, 2=high), col=cost (0=high, 1=medium, 2=low)
        function renderNineBoxGrid(value, cost) {
            const grid = document.getElementById('nineBoxGrid');
            if (!grid) return;
            
            const valueMap = { 'low': 0, 'medium': 1, 'high': 2 };
            const costMap = { 'high': 0, 'medium': 1, 'low': 2 };
            const valueIndex = valueMap[value] || 1;
            const costIndex = costMap[cost] || 1;
            
            grid.innerHTML = '';
            
            for (let row = 2; row >= 0; row--) { // High value at top
                for (let col = 0; col < 3; col++) { // High cost on left
                    const cell = document.createElement('div');
                    const isActive = (row === valueIndex && col === costIndex);
                    
                    if (isActive) {
                        cell.style.background = 'linear-gradient(135deg, var(--pbi-primary) 0%, var(--pbi-primary-dark) 100%)';
                        cell.style.border = '2px solid var(--pbi-primary-dark)';
                        cell.style.color = 'white';
                        cell.style.fontWeight = '700';
                        cell.innerHTML = '<i class="fas fa-check-circle" style="font-size: 20px;"></i>';
                    } else {
                        cell.style.background = 'var(--pbi-background)';
                        cell.style.border = '1px solid var(--pbi-border)';
                        cell.style.color = 'var(--pbi-text-tertiary)';
                    }
                    
                    cell.style.borderRadius = '4px';
                    cell.style.display = 'flex';
                    cell.style.alignItems = 'center';
                    cell.style.justifyContent = 'center';
                    cell.style.cursor = 'pointer';
                    cell.style.transition = 'all 0.2s';
                    
                    cell.onmouseover = function() {
                        if (!isActive) {
                            this.style.background = 'var(--pbi-hover)';
                            this.style.borderColor = 'var(--pbi-border)';
                        }
                    };
                    cell.onmouseout = function() {
                        if (!isActive) {
                            this.style.background = 'var(--pbi-background)';
                            this.style.borderColor = 'var(--pbi-border)';
                        }
                    };
                    
                    grid.appendChild(cell);
                }
            }
            
            // Update badge
            const valueLabels = { 'low': 'Low', 'medium': 'Medium', 'high': 'High' };
            const costLabels = { 'high': 'High', 'medium': 'Medium', 'low': 'Low' };
            const badge = document.getElementById('nineBoxRating');
            if (badge) {
                badge.textContent = `${valueLabels[value]} Value / ${costLabels[cost]} Cost`;
                // Color code badge
                if (value === 'high' && cost === 'low') {
                    badge.style.background = 'var(--chart-green)';
                } else if (value === 'high' && cost === 'high') {
                    badge.style.background = '#ff8c00';
                } else if (value === 'low' && cost === 'high') {
                    badge.style.background = '#d13438';
                } else {
                    badge.style.background = 'var(--pbi-primary)';
                }
            }
        }

        // Sample open items
        const openItems = [
            { type: 'JIRA', title: 'Documentation Review - Q4 2024', desc: 'Pending client signature on updated agreement', priority: 'High' },
            { type: 'OTS', title: 'Data Refresh Request', desc: 'Client requested updated trade data for case analysis', priority: 'Medium' },
            { type: 'AUDIT', title: 'Open Documentation Audit', desc: '3 documents pending review for compliance', priority: 'High' },
            { type: 'JIRA', title: 'Recovery Disbursement Processing', desc: 'Awaiting final approval for $180K disbursement', priority: 'Medium' },
            { type: 'OTS', title: 'New Case Eligibility Review', desc: 'British American Tobacco case requires eligibility determination', priority: 'High' }
        ];

        // Sample recoveries
        const recentRecoveries = [
            { case: 'Barclays Plc (Staley Action)', amount: 180750, date: '8/20/2025', child: 'Wellington Hedge Funds' },
            { case: 'DWS Group', amount: 783416, date: '6/15/2025', child: 'Wellington Mutual Funds' },
            { case: 'Petrobras', amount: 1450000, date: '3/10/2025', child: 'Wellington Global Funds' }
        ];

        const allRecoveries = [
            { case: 'Barclays Plc (Staley Action)', amount: 180750, date: '8/20/2025', child: 'Wellington Hedge Funds' },
            { case: 'DWS Group', amount: 783416, date: '6/15/2025', child: 'Wellington Mutual Funds' },
            { case: 'Petrobras', amount: 1450000, date: '3/10/2025', child: 'Wellington Global Funds' },
            { case: 'Vestas Wind Systems', amount: 194115, date: '2/5/2025', child: 'Wellington Trust Company' },
            { case: 'Bayer AG', amount: 5800000, date: '12/15/2024', child: 'Wellington Hedge Funds' }
        ];

        // Sample interactions
        const recentInteractions = [
            { type: 'Email', details: 'Discussed Q4 recovery expectations and upcoming case deadlines', date: '2 hours ago', user: 'Sarah Johnson' },
            { type: 'Phone Call', details: 'Client inquiry about British American Tobacco case status', date: '1 day ago', user: 'Mike Chen' },
            { type: 'Meeting', details: 'Quarterly review - discussed portfolio performance and new opportunities', date: '3 days ago', user: 'Craig D\'Alessio' },
            { type: 'Portal Activity', details: 'Client accessed case details and downloaded recovery report', date: '5 days ago', user: 'System' }
        ];

        // Sample notifications
        const notifications = [
            { title: 'New Recovery Received', details: 'Barclays Plc recovery of $180,750 processed', date: '2 hours ago', read: false },
            { title: 'Case Status Update', details: 'British American Tobacco case now eligible for opt-in', date: '1 day ago', read: false },
            { title: 'Documentation Required', details: '3 documents pending for Petrobras case review', date: '2 days ago', read: false }
        ];

        // Sample portal users
        const portalUsers = [
            { name: 'John Smith', role: 'Admin', email: 'john.smith@wellington.com', lastActive: '2 hours ago' },
            { name: 'Jane Doe', role: 'User', email: 'jane.doe@wellington.com', lastActive: '1 day ago' },
            { name: 'Bob Wilson', role: 'User', email: 'bob.wilson@wellington.com', lastActive: '3 days ago' }
        ];

        // Sample notification signups
        const notificationSignups = [
            { user: 'John Smith', email: true, portal: true, lastActive: '2 hours ago' },
            { user: 'Jane Doe', email: true, portal: false, lastActive: '1 day ago' },
            { user: 'Bob Wilson', email: false, portal: true, lastActive: '3 days ago' }
        ];

        // Eligibility snapshot
        const eligibilitySnapshot = [
            { label: 'Eligible', count: 12, color: 'var(--chart-green)' },
            { label: 'Not Eligible', count: 5, color: 'var(--chart-red)' },
            { label: 'Under Review', count: 8, color: 'var(--chart-orange)' },
            { label: 'Pending', count: 7, color: 'var(--pbi-text-secondary)' }
        ];

        function formatCurrency(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(0) + 'K';
            }
            return '$' + amount.toLocaleString();
        }

        function updateClientData(clientKey) {
            const client = clientData[clientKey];
            if (!client) return;
            
            // Update basic client info
            document.getElementById('parentClientName').textContent = client.parent;
            if (document.getElementById('clientSubtitle')) {
                document.getElementById('clientSubtitle').textContent = client.clientSubtitle || 'Client since ' + (client.contractDate ? client.contractDate.split('/')[2] : '2020');
            }
            document.getElementById('contractDate').textContent = client.contractDate;
            document.getElementById('atfSignatureDate').textContent = client.atfSignatureDate;
            document.getElementById('dataSource').textContent = client.dataSource;
            document.getElementById('dataRefresh').textContent = client.dataRefresh;
            document.getElementById('cusipClient').textContent = client.cusipClient ? 'Yes' : 'No';
            document.getElementById('cusipClient').className = client.cusipClient ? 'info-card-value yes' : 'info-card-value no';
            document.getElementById('recognizedLoss').textContent = client.recognizedLoss;
            
            // Update new account management fields
            if (document.getElementById('healthScore')) {
                document.getElementById('healthScore').textContent = client.healthScore || 85;
                const healthColor = client.healthScore >= 80 ? 'var(--chart-green)' : 
                                   client.healthScore >= 60 ? '#ff8c00' : '#d13438';
                document.getElementById('healthScore').style.color = healthColor;
            }
            if (document.getElementById('lastContact')) {
                document.getElementById('lastContact').textContent = client.lastContact || 'N/A';
            }
            if (document.getElementById('lastContactType')) {
                document.getElementById('lastContactType').textContent = client.lastContactType || '';
            }
            if (document.getElementById('contractValue')) {
                document.getElementById('contractValue').textContent = client.contractValue || 'N/A';
            }
            if (document.getElementById('renewalDate')) {
                document.getElementById('renewalDate').textContent = client.renewalDate || 'N/A';
            }
            if (document.getElementById('engagementLevel')) {
                document.getElementById('engagementLevel').textContent = client.engagementLevel || 'N/A';
                const engagementColor = client.engagementLevel === 'Very High' || client.engagementLevel === 'High' ? 'var(--chart-green)' :
                                      client.engagementLevel === 'Medium' ? '#ff8c00' : '#d13438';
                document.getElementById('engagementLevel').style.color = engagementColor;
            }
            if (document.getElementById('churnRisk')) {
                document.getElementById('churnRisk').textContent = client.churnRisk || 'N/A';
                const churnColor = client.churnRisk === 'Very Low' || client.churnRisk === 'Low' ? 'var(--chart-green)' :
                                  client.churnRisk === 'Medium' ? '#ff8c00' : '#d13438';
                document.getElementById('churnRisk').style.color = churnColor;
            }
            if (document.getElementById('primaryContact')) {
                document.getElementById('primaryContact').textContent = client.primaryContact || 'N/A';
            }
            if (document.getElementById('accountManager')) {
                document.getElementById('accountManager').textContent = client.accountManager || 'N/A';
            }
            
            // Update 9 Box grid
            if (client.nineBoxValue && client.nineBoxCost) {
                renderNineBoxGrid(client.nineBoxValue, client.nineBoxCost);
            }
            
            // Update performance metrics
            if (document.getElementById('recoveryRate')) {
                document.getElementById('recoveryRate').textContent = (client.recoveryRate || 18.4).toFixed(1) + '%';
            }
            if (document.getElementById('filingEfficiency')) {
                document.getElementById('filingEfficiency').textContent = (client.filingEfficiency || 94) + '%';
            }
            if (document.getElementById('avgDaysToRecovery')) {
                document.getElementById('avgDaysToRecovery').textContent = client.avgDaysToRecovery || 127;
            }
            if (document.getElementById('clientSatisfaction')) {
                document.getElementById('clientSatisfaction').textContent = (client.clientSatisfaction || 4.8).toFixed(1) + '/5';
            }
            
            // Update KPI cards
            if (document.getElementById('totalRecoveriesKPI')) {
                document.getElementById('totalRecoveriesKPI').textContent = formatCurrency(client.totalRecoveries || 8400000);
            }
            if (document.getElementById('claimsFiledKPI')) {
                document.getElementById('claimsFiledKPI').textContent = client.claimsFiled || 47;
            }
            if (document.getElementById('eligibleCasesKPI')) {
                document.getElementById('eligibleCasesKPI').textContent = client.eligibleCases || 32;
            }
            if (document.getElementById('expectedRecoveryKPI')) {
                document.getElementById('expectedRecoveryKPI').textContent = formatCurrency(client.expectedRecovery || 12200000);
            }
            
            // Populate smart recommendations
            populateSmartRecommendations(client.recommendations || []);
            
            // Populate revenue opportunities
            populateRevenueOpportunities(client.revenueOpportunities || []);
            
            // Populate relationship timeline
            populateRelationshipTimeline(client.relationshipTimeline || []);
            
            // Populate engagement heatmap
            populateEngagementHeatmap(client.engagementData || []);
        }
        
        function populateRelationshipTimeline(events) {
            const container = document.getElementById('relationshipTimeline');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (events.length === 0) {
                container.innerHTML = '<div style="padding: 12px; text-align: center; color: var(--pbi-text-secondary); font-size: 10px;">No timeline data available</div>';
                return;
            }
            
            events.forEach((event, index) => {
                const div = document.createElement('div');
                const typeColor = event.type === 'milestone' ? 'var(--pbi-primary)' : 
                                 event.type === 'success' ? 'var(--chart-green)' : 
                                 event.type === 'upsell' ? '#ff8c00' : 'var(--pbi-text-secondary)';
                
                div.style.cssText = 'position: relative; padding-left: 32px; padding-bottom: 16px;';
                if (index < events.length - 1) {
                    div.style.borderLeft = '2px solid var(--pbi-border-light)';
                    div.style.marginLeft = '-24px';
                }
                
                div.innerHTML = `
                    <div style="position: absolute; left: 0; top: 2px;">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: ${typeColor}; border: 3px solid white; box-shadow: 0 0 0 2px ${typeColor};"></div>
                    </div>
                    <div style="font-size: 9px; color: var(--pbi-text-secondary); margin-bottom: 2px;">${event.date}</div>
                    <div style="font-size: 11px; font-weight: 600; color: var(--pbi-text-primary); display: flex; align-items: center; gap: 6px;">
                        <i class="fas ${event.icon}" style="color: ${typeColor}; font-size: 10px;"></i>
                        ${event.event}
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        function populateEngagementHeatmap(data) {
            const container = document.getElementById('engagementHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Use last 90 days of data
            const last90Days = data.slice(-90);
            
            last90Days.forEach((count, index) => {
                const cell = document.createElement('div');
                const intensity = Math.min(count / 3, 1); // Normalize to 0-1
                const bgColor = intensity === 0 ? 'var(--pbi-background)' :
                               intensity < 0.33 ? 'rgba(0, 120, 212, 0.2)' :
                               intensity < 0.67 ? 'rgba(0, 120, 212, 0.5)' :
                               'var(--pbi-primary)';
                
                cell.style.cssText = `aspect-ratio: 1; background: ${bgColor}; border-radius: 2px; border: 1px solid var(--pbi-border-light); cursor: pointer; transition: all 0.2s;`;
                cell.title = `${count} interaction${count !== 1 ? 's' : ''} on day ${index + 1}`;
                cell.onmouseover = function() {
                    this.style.transform = 'scale(1.2)';
                    this.style.zIndex = '10';
                };
                cell.onmouseout = function() {
                    this.style.transform = 'scale(1)';
                    this.style.zIndex = '1';
                };
                
                container.appendChild(cell);
            });
        }
        
        function populateSmartRecommendations(recommendations) {
            const container = document.getElementById('smartRecommendations');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (recommendations.length === 0) {
                container.innerHTML = '<div style="padding: 12px; text-align: center; color: var(--pbi-text-secondary); font-size: 10px;">No recommendations at this time</div>';
                return;
            }
            
            recommendations.forEach((rec, index) => {
                const div = document.createElement('div');
                const priorityColor = rec.priority === 'high' ? '#d13438' : rec.priority === 'medium' ? '#ff8c00' : '#0078d4';
                const icon = rec.type === 'renewal' ? 'fa-calendar-check' : rec.type === 'upsell' ? 'fa-arrow-trend-up' : 'fa-handshake';
                
                div.style.cssText = 'padding: 10px; margin-bottom: 8px; background: white; border-left: 3px solid ' + priorityColor + '; border-radius: 3px; cursor: pointer; transition: all 0.2s;';
                div.onmouseover = function() { this.style.transform = 'translateX(4px)'; this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)'; };
                div.onmouseout = function() { this.style.transform = 'translateX(0)'; this.style.boxShadow = 'none'; };
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
                                <i class="fas ${icon}" style="color: ${priorityColor}; font-size: 12px;"></i>
                                <span style="font-weight: 600; font-size: 11px; color: var(--pbi-text-primary);">${rec.title}</span>
                                ${rec.value ? '<span style="font-size: 9px; color: var(--chart-green); font-weight: 600;">' + rec.value + '</span>' : ''}
                            </div>
                            <div style="font-size: 9px; color: var(--pbi-text-secondary); line-height: 1.4; margin-bottom: 6px;">${rec.desc}</div>
                        </div>
                        <span style="background: ${priorityColor}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 8px; font-weight: 600; text-transform: uppercase; margin-left: 8px;">${rec.priority}</span>
                    </div>
                    <button style="background: ${priorityColor}; color: white; border: none; padding: 4px 12px; border-radius: 3px; font-size: 9px; font-weight: 600; cursor: pointer; transition: all 0.2s;" 
                            onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                        <i class="fas fa-bolt" style="margin-right: 4px;"></i>${rec.action}
                    </button>
                `;
                container.appendChild(div);
            });
        }
        
        function populateRevenueOpportunities(opportunities) {
            const container = document.getElementById('revenueOpportunities');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (opportunities.length === 0) {
                container.innerHTML = '<div style="padding: 12px; text-align: center; color: var(--pbi-text-secondary); font-size: 10px;">No opportunities identified</div>';
                return;
            }
            
            let totalValue = 0;
            opportunities.forEach(opp => {
                const div = document.createElement('div');
                const urgencyColor = opp.urgency === 'high' ? '#d13438' : '#ff8c00';
                
                div.style.cssText = 'padding: 10px; margin-bottom: 8px; background: white; border-left: 3px solid ' + urgencyColor + '; border-radius: 3px;';
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 11px; color: var(--pbi-text-primary); margin-bottom: 4px;">${opp.title}</div>
                            <div style="font-size: 9px; color: var(--pbi-text-secondary); line-height: 1.4;">${opp.desc}</div>
                        </div>
                        <div style="text-align: right; margin-left: 12px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--chart-green);">${opp.value}</div>
                            <span style="background: ${urgencyColor}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 8px; font-weight: 600; text-transform: uppercase; margin-top: 4px; display: inline-block;">${opp.urgency}</span>
                        </div>
                    </div>
                `;
                container.appendChild(div);
                
                // Extract numeric value for total
                const valueMatch = opp.value.match(/[\d.]+/);
                if (valueMatch) {
                    const num = parseFloat(valueMatch[0]);
                    if (opp.value.includes('M')) totalValue += num * 1000000;
                    else if (opp.value.includes('K')) totalValue += num * 1000;
                    else totalValue += num;
                }
            });
            
            // Update opportunity value badge
            const badge = document.getElementById('opportunityValue');
            if (badge && totalValue > 0) {
                badge.textContent = formatCurrency(totalValue) + ' Potential';
            }
        }

        function populateClientHierarchy() {
            const client = clientData.wellington;
            document.getElementById('parentClientName').textContent = client.parent;
            
            const childContainer = document.getElementById('childClients');
            childContainer.innerHTML = '';
            
            client.children.forEach(child => {
                const badge = document.createElement('div');
                badge.className = `child-client-badge ${child.active ? 'active' : ''}`;
                badge.textContent = child.name;
                badge.onclick = () => selectChildClient(child.id);
                childContainer.appendChild(badge);
            });
            
            // Update all client data
            updateClientData('wellington');
        }

        function selectChildClient(childId) {
            // Update active state
            document.querySelectorAll('.child-client-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter data by child client
            // In real implementation, this would fetch child-specific data
            console.log('Selected child client:', childId);
        }

        function populateQuickOpenItems() {
            const container = document.getElementById('quickOpenItems');
            container.innerHTML = '';
            
            // Show top 3 most urgent (prioritize High priority and Audits)
            const sorted = [...openItems].sort((a, b) => {
                if (a.priority === 'High' && b.priority !== 'High') return -1;
                if (a.type === 'AUDIT' && b.type !== 'AUDIT') return -1;
                return 0;
            }).slice(0, 3);
            
            sorted.forEach(item => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 6px 0; border-bottom: 1px solid var(--pbi-border-light); font-size: 10px;';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2px;">
                        <div style="font-weight: 600; color: var(--pbi-text-primary); flex: 1;">${item.title}</div>
                        <span class="open-item-badge badge-${item.type.toLowerCase()}" style="font-size: 8px; padding: 2px 6px; margin-left: 6px;">${item.type}</span>
                    </div>
                    <div style="color: var(--pbi-text-secondary); font-size: 9px; line-height: 1.3;">${item.desc}</div>
                `;
                container.appendChild(div);
            });
        }

        function populateOpenItems() {
            const container = document.getElementById('openItemsList');
            container.innerHTML = '';
            
            openItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'open-item';
                div.innerHTML = `
                    <div class="open-item-left">
                        <div class="open-item-title">${item.title}</div>
                        <div class="open-item-desc">${item.desc}</div>
                    </div>
                    <div>
                        <span class="open-item-badge badge-${item.type.toLowerCase()}">${item.type}</span>
                        <span class="open-item-badge" style="background: ${item.priority === 'High' ? '#d13438' : '#ff8c00'}; color: white;">${item.priority}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function populateRecentRecoveries() {
            const container = document.getElementById('recentRecoveriesList');
            container.innerHTML = '';
            
            recentRecoveries.forEach(recovery => {
                const div = document.createElement('div');
                div.className = 'recovery-item';
                div.innerHTML = `
                    <div>
                        <div class="recovery-case">${recovery.case}</div>
                        <div class="recovery-date">${recovery.date} • ${recovery.child}</div>
                    </div>
                    <div class="recovery-amount">${formatCurrency(recovery.amount)}</div>
                `;
                container.appendChild(div);
            });
        }

        function populateAllRecoveries() {
            const tbody = document.getElementById('allRecoveriesBody');
            tbody.innerHTML = '';
            
            let total = 0;
            allRecoveries.forEach(recovery => {
                total += recovery.amount;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${recovery.case}</td>
                    <td class="currency" style="text-align: right; font-weight: 600;">${formatCurrency(recovery.amount)}</td>
                    <td class="date-cell">${recovery.date}</td>
                    <td>${recovery.child}</td>
                `;
                tbody.appendChild(tr);
            });
            
            document.getElementById('totalRecoveriesAmount').textContent = formatCurrency(total);
        }

        function populateQuickInteractions() {
            const container = document.getElementById('quickInteractions');
            container.innerHTML = '';
            
            // Show last 3 interactions
            recentInteractions.slice(0, 3).forEach(interaction => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 6px 0; border-bottom: 1px solid var(--pbi-border-light); font-size: 10px;';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <div style="font-weight: 600; color: var(--pbi-text-primary); display: flex; align-items: center; gap: 4px;">
                            <i class="fas fa-${interaction.type === 'Email' ? 'envelope' : interaction.type === 'Phone Call' ? 'phone' : interaction.type === 'Meeting' ? 'calendar' : 'user'}" style="font-size: 9px; color: var(--pbi-primary);"></i>
                            ${interaction.type}
                        </div>
                        <div style="font-size: 9px; color: var(--pbi-text-secondary);">${interaction.date}</div>
                    </div>
                    <div style="color: var(--pbi-text-secondary); font-size: 9px; line-height: 1.3;">${interaction.details}</div>
                    <div style="font-size: 8px; color: var(--pbi-text-secondary); margin-top: 2px;">${interaction.user}</div>
                `;
                container.appendChild(div);
            });
        }

        function populateRecentInteractions() {
            const container = document.getElementById('recentInteractionsList');
            container.innerHTML = '';
            
            recentInteractions.forEach(interaction => {
                const div = document.createElement('div');
                div.className = 'interaction-item';
                div.innerHTML = `
                    <div class="interaction-header">
                        <div class="interaction-type">
                            <i class="fas fa-${interaction.type === 'Email' ? 'envelope' : interaction.type === 'Phone Call' ? 'phone' : interaction.type === 'Meeting' ? 'calendar' : 'user'}"></i>
                            ${interaction.type}
                        </div>
                        <div class="interaction-date">${interaction.date}</div>
                    </div>
                    <div class="interaction-details">${interaction.details}</div>
                    <div class="interaction-details" style="margin-top: 2px; font-size: 9px; color: var(--pbi-text-secondary);">By: ${interaction.user}</div>
                `;
                container.appendChild(div);
            });
        }

        function populateQuickUpcoming() {
            const container = document.getElementById('quickUpcoming');
            container.innerHTML = '';
            
            // Combine upcoming deadlines and new notifications
            const upcomingDeadlines = [
                { type: 'deadline', title: 'Documentation Audit Due', date: 'In 3 days', priority: 'High' },
                { type: 'deadline', title: 'Case Eligibility Review', date: 'In 7 days', priority: 'Medium' }
            ];
            
            const combined = [...notifications.slice(0, 1), ...upcomingDeadlines.slice(0, 2)];
            
            combined.forEach(item => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 6px 0; border-bottom: 1px solid var(--pbi-border-light); font-size: 10px;';
                const isDeadline = item.type === 'deadline';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2px;">
                        <div style="font-weight: 600; color: var(--pbi-text-primary); flex: 1;">${item.title}</div>
                        <div style="font-size: 9px; color: ${isDeadline && item.priority === 'High' ? '#d13438' : 'var(--pbi-text-secondary)'}; margin-left: 6px;">${item.date || item.date}</div>
                    </div>
                    ${item.details ? `<div style="color: var(--pbi-text-secondary); font-size: 9px; line-height: 1.3;">${item.details}</div>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function populateNotifications() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            
            notifications.forEach(notif => {
                const div = document.createElement('div');
                div.className = 'interaction-item';
                div.style.background = notif.read ? 'transparent' : 'var(--pbi-background)';
                div.style.padding = '8px';
                div.style.borderRadius = '4px';
                div.innerHTML = `
                    <div class="interaction-header">
                        <div class="interaction-type">${notif.title}</div>
                        <div class="interaction-date">${notif.date}</div>
                    </div>
                    <div class="interaction-details">${notif.details}</div>
                `;
                container.appendChild(div);
            });
        }

        function populatePortalUsers() {
            const container = document.getElementById('portalUsersList');
            container.innerHTML = '';
            
            portalUsers.forEach(user => {
                const badge = document.createElement('div');
                badge.className = `user-badge ${user.role === 'Admin' ? 'admin' : ''}`;
                badge.innerHTML = `
                    <i class="fas fa-${user.role === 'Admin' ? 'user-shield' : 'user'}"></i>
                    <span>${user.name}</span>
                    <span style="font-size: 9px; opacity: 0.7;">(${user.lastActive})</span>
                `;
                container.appendChild(badge);
            });
        }

        function populateNotificationSignups() {
            const tbody = document.getElementById('notificationSignupsBody');
            tbody.innerHTML = '';
            
            notificationSignups.forEach(signup => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${signup.user}</td>
                    <td style="text-align: center;">
                        <span class="case-status-badge ${signup.email ? 'status-confirmed' : 'status-not-eligible'}">
                            ${signup.email ? 'Yes' : 'No'}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <span class="case-status-badge ${signup.portal ? 'status-confirmed' : 'status-not-eligible'}">
                            ${signup.portal ? 'Yes' : 'No'}
                        </span>
                    </td>
                    <td class="date-cell">${signup.lastActive}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateEligibilitySnapshot() {
            const container = document.getElementById('eligibilitySnapshot');
            if (!container) {
                // Element doesn't exist (was on Page 3 which was removed)
                return;
            }
            container.innerHTML = '';
            
            eligibilitySnapshot.forEach(item => {
                const card = document.createElement('div');
                card.className = 'eligibility-card';
                card.innerHTML = `
                    <div class="eligibility-count" style="color: ${item.color};">${item.count}</div>
                    <div class="eligibility-label">${item.label}</div>
                `;
                container.appendChild(card);
            });
        }

        // Page Navigation Functions
        function showPage(pageNumber, buttonElement) {
            console.log('showPage called with:', pageNumber);
            
            // Hide all pages
            document.querySelectorAll('.dashboard-page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            
            // Show selected page
            const targetPage = document.getElementById(`page${pageNumber}`);
            if (targetPage) {
                targetPage.classList.add('active');
                targetPage.style.display = 'block';
                targetPage.style.visibility = 'visible';
            } else {
                console.error('Page not found:', `page${pageNumber}`);
                return;
            }
            
            // Update navigation buttons
            document.querySelectorAll('.page-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            } else {
                const buttons = document.querySelectorAll('.page-nav-btn');
                if (buttons[pageNumber - 1]) {
                    buttons[pageNumber - 1].classList.add('active');
                }
            }
            
            // Update page indicator
            const indicator = document.getElementById('currentPageIndicator');
            if (indicator) {
                indicator.textContent = `Page ${pageNumber} of 2`;
            }
            
            // Resize Page 1 charts when switching back
            if (pageNumber === 1) {
                setTimeout(() => {
                    const trendCanvas = document.getElementById('recoveryTrendChart');
                    const statusCanvas = document.getElementById('caseStatusChart');
                    const accountCanvas = document.getElementById('recoveryByAccountChart');
                    
                    if (trendCanvas && trendCanvas.chart) {
                        trendCanvas.chart.resize();
                    }
                    if (statusCanvas && statusCanvas.chart) {
                        statusCanvas.chart.resize();
                    }
                    if (accountCanvas && accountCanvas.chart) {
                        accountCanvas.chart.resize();
                    }
                }, 200);
            }
        }

        function exportTable(tableId, filename) {
            const table = document.getElementById(tableId);
            if (!table) {
                // For non-table exports, create a simple CSV
                alert('Export functionality for this section coming soon!');
                return;
            }
            
            let csv = [];
            const rows = table.querySelectorAll('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = [];
                const cols = rows[i].querySelectorAll('td, th');
                
                for (let j = 0; j < cols.length; j++) {
                    let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/"/g, '""');
                    row.push('"' + data + '"');
                }
                csv.push(row.join(','));
            }
            
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename + '_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Tab navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                if (this.textContent.includes('OPT-IN MONITORING')) {
                    window.location.href = 'opt-in-monitoring.html';
                } else if (this.textContent.includes('ELIGIBILITY & FILINGS')) {
                    window.location.href = 'eligibility-filings.html';
                } else if (this.textContent.includes('STATUS REPORTS')) {
                    window.location.href = 'client-status-reports.html';
                } else if (this.textContent.includes('REMITTANCE')) {
                    // Add navigation for remittance if needed
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                } else {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Recovery trend data with dates (extended for multiple years)
        const recoveryTrendData = [
            // 2022
            { date: '2022-01-15', amount: 450000 },
            { date: '2022-03-20', amount: 320000 },
            { date: '2022-06-10', amount: 890000 },
            { date: '2022-09-15', amount: 210000 },
            { date: '2022-11-30', amount: 560000 },
            // 2023
            { date: '2023-02-10', amount: 780000 },
            { date: '2023-04-25', amount: 420000 },
            { date: '2023-07-18', amount: 950000 },
            { date: '2023-10-05', amount: 340000 },
            { date: '2023-12-20', amount: 680000 },
            // 2024
            { date: '2024-01-15', amount: 0 },
            { date: '2024-02-20', amount: 0 },
            { date: '2024-03-10', amount: 1450000 },
            { date: '2024-04-05', amount: 0 },
            { date: '2024-05-12', amount: 0 },
            { date: '2024-06-15', amount: 783416 },
            { date: '2024-07-22', amount: 0 },
            { date: '2024-08-20', amount: 180750 },
            { date: '2024-09-18', amount: 0 },
            { date: '2024-10-25', amount: 0 },
            { date: '2024-11-30', amount: 0 },
            { date: '2024-12-15', amount: 0 }
        ];
        
        let currentRecoveryTrendPeriod = 1; // Default to 1 year

        // Chart creation functions
        function createRecoveryTrendChart() {
            const canvas = document.getElementById('recoveryTrendChart');
            if (!canvas) {
                console.error('recoveryTrendChart canvas not found');
                return;
            }
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                setTimeout(() => createRecoveryTrendChart(), 500);
                return;
            }
            
            // Destroy existing chart if it exists
            if (canvas.chart) {
                canvas.chart.destroy();
            }
            
            const ctx = canvas.getContext('2d');
            
            // Calculate date range based on period selection
            const today = new Date();
            let startDate = new Date();
            let useQuarters = false;
            
            if (currentRecoveryTrendPeriod === 1) {
                startDate.setFullYear(today.getFullYear() - 1);
                useQuarters = false; // Show months
            } else if (currentRecoveryTrendPeriod === 2) {
                startDate.setFullYear(today.getFullYear() - 2);
                useQuarters = false; // Show months
            } else if (currentRecoveryTrendPeriod === 3) {
                startDate.setFullYear(today.getFullYear() - 3);
                useQuarters = true; // Show quarters
            } else {
                // All time
                startDate = new Date('2022-01-01');
                useQuarters = true; // Show quarters
            }
            
            // Filter data based on date range
            const filteredData = recoveryTrendData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= today;
            });
            
            // Group data by month or quarter
            const groupedData = {};
            filteredData.forEach(item => {
                const date = new Date(item.date);
                let key;
                
                if (useQuarters) {
                    const quarter = Math.floor(date.getMonth() / 3) + 1;
                    const year = date.getFullYear();
                    key = `Q${quarter} ${year}`;
                } else {
                    key = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                }
                
                if (!groupedData[key]) {
                    groupedData[key] = 0;
                }
                groupedData[key] += item.amount;
            });
            
            // Convert to arrays for chart, sorted by date
            const labels = Object.keys(groupedData).sort((a, b) => {
                if (useQuarters) {
                    // Parse quarters: "Q1 2022" -> Date
                    const matchA = a.match(/Q(\d) (\d{4})/);
                    const matchB = b.match(/Q(\d) (\d{4})/);
                    if (matchA && matchB) {
                        const yearA = parseInt(matchA[2]);
                        const quarterA = parseInt(matchA[1]);
                        const yearB = parseInt(matchB[2]);
                        const quarterB = parseInt(matchB[1]);
                        if (yearA !== yearB) return yearA - yearB;
                        return quarterA - quarterB;
                    }
                }
                // For months, parse as date
                return new Date(a) - new Date(b);
            });
            const data = labels.map(label => groupedData[label]);
            
            const recoveryData = {
                labels: labels,
                datasets: [{
                    label: 'Recoveries',
                    data: data,
                    backgroundColor: 'rgba(16, 124, 16, 0.8)',
                    borderColor: '#107c10',
                    borderWidth: 2,
                    borderRadius: 4
                }]
            };
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: recoveryData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Store chart reference
            canvas.chart = chart;
        }
        
        // Initialize period selector buttons
        function initRecoveryTrendDateSlicer() {
            const periodButtons = document.querySelectorAll('.recovery-trend-period-btn');
            
            if (!periodButtons.length) return;
            
            // Add event listeners to period buttons
            periodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Update active state
                    periodButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.style.background = 'var(--pbi-card-bg)';
                        btn.style.color = 'var(--pbi-text-primary)';
                        btn.style.borderColor = 'var(--pbi-border)';
                    });
                    
                    this.classList.add('active');
                    this.style.background = 'var(--pbi-primary)';
                    this.style.color = 'white';
                    this.style.borderColor = 'var(--pbi-primary)';
                    
                    // Update period
                    const period = this.getAttribute('data-period');
                    currentRecoveryTrendPeriod = period === 'all' ? 'all' : parseInt(period);
                    
                    // Update chart
                    createRecoveryTrendChart();
                });
            });
        }

        function createCaseStatusChart() {
            const canvas = document.getElementById('caseStatusChart');
            if (!canvas) {
                console.error('caseStatusChart canvas not found');
                return;
            }
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                setTimeout(() => createCaseStatusChart(), 500);
                return;
            }
            
            // Destroy existing chart if it exists
            if (canvas.chart) {
                canvas.chart.destroy();
            }
            
            const ctx = canvas.getContext('2d');
            
            const statusData = {
                labels: ['Eligible', 'Not Eligible', 'Under Review', 'Pending', 'Filed'],
                datasets: [{
                    data: [32, 5, 8, 2, 0],
                    backgroundColor: [
                        '#107c10',
                        '#d13438',
                        '#ff8c00',
                        '#605e5c',
                        '#0078d4'
                    ],
                    borderWidth: 0
                }]
            };
            
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: statusData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 9
                                },
                                padding: 8,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return label + ': ' + value + ' cases';
                                }
                            }
                        }
                    }
                }
            });
            
            // Store chart reference
            canvas.chart = chart;
        }

        function createRecoveryByAccountChart() {
            const canvas = document.getElementById('recoveryByAccountChart');
            if (!canvas) {
                console.error('recoveryByAccountChart canvas not found');
                return;
            }
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                setTimeout(() => createRecoveryByAccountChart(), 500);
                return;
            }
            
            // Destroy existing chart if it exists
            if (canvas.chart) {
                canvas.chart.destroy();
            }
            
            const ctx = canvas.getContext('2d');
            
            const accountData = {
                labels: ['Hedge Funds', 'Mutual Funds', 'Global Funds', 'Trust Company'],
                datasets: [{
                    label: 'Recoveries',
                    data: [5980750, 783416, 1450000, 194115],
                    backgroundColor: [
                        'rgba(0, 120, 212, 0.8)',
                        'rgba(255, 140, 0, 0.8)',
                        'rgba(16, 124, 16, 0.8)',
                        'rgba(135, 100, 184, 0.8)'
                    ],
                    borderColor: [
                        '#0078d4',
                        '#ff8c00',
                        '#107c10',
                        '#8764b8'
                    ],
                    borderWidth: 2,
                    borderRadius: 4
                }]
            };
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: accountData,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatCurrency(context.parsed.x);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Store chart reference
            canvas.chart = chart;
        }

        // ============================================
        // Page 3 removed - charts were not working properly

        // Initialize
        // Client selector change handler
        document.getElementById('clientSelect').addEventListener('change', function(e) {
            const clientKey = e.target.value;
            // Update URL without page reload
            const newURL = window.location.pathname + '?client=' + clientKey;
            window.history.pushState({ client: clientKey }, '', newURL);
            updateClientData(clientKey);
            // Update hierarchy for selected client
            const client = clientData[clientKey];
            if (client) {
                document.getElementById('parentClientName').textContent = client.parent;
                const childContainer = document.getElementById('childClients');
                childContainer.innerHTML = '';
                if (client.children && client.children.length > 0) {
                    client.children.forEach(child => {
                        const badge = document.createElement('div');
                        badge.className = `child-client-badge ${child.active ? 'active' : ''}`;
                        badge.textContent = child.name;
                        badge.onclick = () => selectChildClient(child.id);
                        childContainer.appendChild(badge);
                    });
                }
            }
        });
        
        // Navigation handlers
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const text = this.textContent.trim();
                if (text.includes('ELIGIBILITY')) {
                    window.location.href = 'eligibility-filings.html';
                } else if (text.includes('STATUS REPORTS')) {
                    window.location.href = 'client-status-reports.html';
                } else if (text.includes('OPT-IN')) {
                    window.location.href = 'opt-in-monitoring.html';
                } else if (text.includes('REMITTANCE')) {
                    window.location.href = 'client-remittance.html';
                } else if (text.includes('My Portfolio')) {
                    window.location.href = 'account-manager-portfolio.html';
                }
            });
        });

        // Check for URL parameter to load specific client
        function getClientFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('client') || 'wellington';
        }

        window.addEventListener('DOMContentLoaded', () => {
            // Load client from URL parameter if present
            const clientKey = getClientFromURL();
            if (clientData[clientKey]) {
                document.getElementById('clientSelect').value = clientKey;
                updateClientData(clientKey);
            }
            
            populateClientHierarchy();
            populateQuickOpenItems();
            populateOpenItems();
            populateQuickInteractions();
            populateRecentRecoveries();
            populateAllRecoveries();
            populateRecentInteractions();
            populateQuickUpcoming();
            populateNotifications();
            populatePortalUsers();
            populateNotificationSignups();
            populateEligibilitySnapshot();
            
            // Initialize date slicer
            initRecoveryTrendDateSlicer();
            
            // Create all charts on page load
            function initCharts() {
                if (typeof Chart !== 'undefined') {
                    console.log('Chart.js loaded, creating charts...');
                    
                    // Ensure Page 1 is visible
                    const page1 = document.getElementById('page1');
                    if (page1) {
                        page1.classList.add('active');
                        page1.style.display = 'block';
                    }
                    
                    // Wait a moment for DOM to be ready, then create charts
                    setTimeout(() => {
                        try {
                            createRecoveryTrendChart();
                            createCaseStatusChart();
                            createRecoveryByAccountChart();
                            console.log('All charts created successfully');
                            
                            // Force resize after creation
                            setTimeout(() => {
                                const trendCanvas = document.getElementById('recoveryTrendChart');
                                const statusCanvas = document.getElementById('caseStatusChart');
                                const accountCanvas = document.getElementById('recoveryByAccountChart');
                                
                                if (trendCanvas && trendCanvas.chart) {
                                    trendCanvas.chart.resize();
                                }
                                if (statusCanvas && statusCanvas.chart) {
                                    statusCanvas.chart.resize();
                                }
                                if (accountCanvas && accountCanvas.chart) {
                                    accountCanvas.chart.resize();
                                }
                            }, 200);
                        } catch (e) {
                            console.error('Error creating charts:', e);
                        }
                    }, 100);
                } else {
                    console.log('Chart.js not loaded yet, waiting...');
                    setTimeout(initCharts, 200);
                }
            }
            
            // Wait for Chart.js to load
            if (document.readyState === 'loading') {
                window.addEventListener('load', initCharts);
            } else {
                setTimeout(initCharts, 500);
            }
        });
    </script>
</body>
</html>

