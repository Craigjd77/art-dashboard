<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remittance | FRT Work Tools</title>
    <script>
        // Authentication check - redirect to login if not authenticated
        if (sessionStorage.getItem('frt_authenticated') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="style-switcher.css">
    
    <style>
        /* Cross-browser compatibility fixes */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        .remittance-kpi-grid {
            display: -webkit-grid;
            display: grid;
            -webkit-grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            -webkit-column-gap: 10px;
            -moz-column-gap: 10px;
            column-gap: 10px;
            -webkit-row-gap: 10px;
            -moz-row-gap: 10px;
            row-gap: 10px;
            gap: 10px;
            margin-bottom: 12px;
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        @supports not (grid-template-columns: repeat(auto-fit, minmax(180px, 1fr))) {
            .remittance-kpi-grid {
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                -webkit-flex-wrap: wrap;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                margin: 0 -5px 12px -5px;
            }
            
            .remittance-kpi-grid > * {
                -webkit-flex: 1 1 180px;
                -ms-flex: 1 1 180px;
                flex: 1 1 180px;
                margin: 0 5px 10px 5px;
                min-width: 180px;
            }
        }
        
        .status-cards {
            display: -webkit-grid;
            display: grid;
            -webkit-grid-template-columns: repeat(4, 1fr);
            grid-template-columns: repeat(4, 1fr);
            -webkit-column-gap: 10px;
            -moz-column-gap: 10px;
            column-gap: 10px;
            -webkit-row-gap: 10px;
            -moz-row-gap: 10px;
            row-gap: 10px;
            gap: 10px;
            margin-bottom: 12px;
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        @supports not (grid-template-columns: repeat(4, 1fr)) {
            .status-cards {
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                -webkit-flex-wrap: wrap;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
                margin: 0 -5px 12px -5px;
            }
            
            .status-cards > * {
                -webkit-flex: 1 1 calc(25% - 10px);
                -ms-flex: 1 1 calc(25% - 10px);
                flex: 1 1 calc(25% - 10px);
                margin: 0 5px 10px 5px;
                min-width: 200px;
            }
        }
        
        .status-card {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            padding: 12px;
            -webkit-box-shadow: var(--pbi-shadow);
            -moz-box-shadow: var(--pbi-shadow);
            box-shadow: var(--pbi-shadow);
            border-left: 4px solid;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .status-card.received {
            border-left-color: #107c10;
        }
        
        /* Payable = funds in FRT lockbox and ready to pay */
        .status-card.payable {
            border-left-color: #107c10;
        }
        
        /* Paid = wired out to client */
        .status-card.paid {
            border-left-color: #0078d4;
        }
        
        /* Payment Returned = wire bounced / returned by bank */
        .status-card.returned {
            border-left-color: #d13438;
        }
        
        .status-card-title {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--pbi-text-secondary);
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .status-card-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--pbi-text);
            margin-bottom: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .status-card-count {
            font-size: 9px;
            color: var(--pbi-text-secondary);
        }
        
        .remittance-tabs {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-column-gap: 4px;
            -moz-column-gap: 4px;
            column-gap: 4px;
            -webkit-row-gap: 4px;
            -moz-row-gap: 4px;
            row-gap: 4px;
            gap: 4px;
            margin-bottom: 12px;
            border-bottom: 2px solid var(--pbi-border);
        }
        
        .remittance-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 12px;
            font-weight: 500;
            color: var(--pbi-text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: -2px;
        }
        
        .remittance-tab:hover {
            color: var(--pbi-primary);
            background: var(--pbi-hover);
        }
        
        .remittance-tab.active {
            color: var(--pbi-primary);
            border-bottom-color: var(--pbi-primary);
            background: var(--pbi-hover);
        }
        
        .remittance-table {
            width: 100%;
            min-width: 1000px;
            border-collapse: collapse;
            font-size: 9px;
            table-layout: auto;
        }
        
        .remittance-table thead {
            background: var(--pbi-hover);
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .remittance-table th {
            padding: 6px 8px;
            text-align: left;
            font-weight: 600;
            color: var(--pbi-text);
            border-bottom: 2px solid var(--pbi-border);
            white-space: nowrap;
            font-size: 9px;
            background: var(--pbi-hover);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .remittance-table td {
            padding: 6px 8px;
            border-bottom: 1px solid var(--pbi-border-light);
            color: var(--pbi-text);
            white-space: nowrap;
        }
        
        .remittance-table .currency-cell {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        
        .remittance-table .date-cell {
            white-space: nowrap;
        }
        
        .remittance-table .number-cell {
            text-align: right;
        }
        
        .remittance-table tbody tr:hover {
            background: var(--pbi-hover);
        }
        
        .payment-status-badge {
            padding: 2px 6px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
        }
        
        /* Status badges aligned to remittance lifecycle */
        .status-payable,
        .status-received {
            background: rgba(16, 124, 16, 0.1);
            color: #107c10;
        }
        
        .status-paid,
        .status-cleared {
            background: rgba(0, 120, 212, 0.1);
            color: #0078d4;
        }
        
        .status-payment-returned,
        .status-returned {
            background: rgba(209, 52, 56, 0.1);
            color: #d13438;
        }
        
        .reconciliation-status {
            padding: 2px 6px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 600;
            display: inline-block;
        }
        
        .recon-matched {
            background: rgba(16, 124, 16, 0.1);
            color: #107c10;
        }
        
        .recon-unmatched {
            background: rgba(255, 185, 0, 0.1);
            color: #ca5010;
        }
        
        .recon-flagged {
            background: rgba(209, 52, 56, 0.1);
            color: #d13438;
        }
        
        .payment-method-badge {
            font-size: 8px;
            padding: 2px 6px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            background: var(--pbi-hover);
            color: var(--pbi-text);
            display: inline-block;
        }
        
        .days-indicator {
            font-size: 8px;
            padding: 2px 6px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-weight: 600;
            display: inline-block;
        }
        
        .days-overdue {
            background: rgba(209, 52, 56, 0.1);
            color: #d13438;
        }
        
        .days-approaching {
            background: rgba(255, 185, 0, 0.1);
            color: #ca5010;
        }
        
        .days-normal {
            background: rgba(0, 120, 212, 0.1);
            color: #0078d4;
        }
        
        .filter-bar {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-column-gap: 8px;
            -moz-column-gap: 8px;
            column-gap: 8px;
            -webkit-row-gap: 8px;
            -moz-row-gap: 8px;
            row-gap: 8px;
            gap: 8px;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 10px;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .filter-group {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-column-gap: 6px;
            -moz-column-gap: 6px;
            column-gap: 6px;
            -webkit-row-gap: 6px;
            -moz-row-gap: 6px;
            row-gap: 6px;
            gap: 6px;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-flex-shrink: 0;
            -ms-flex-negative: 0;
            flex-shrink: 0;
        }
        
        .filter-group label {
            font-size: 10px;
            font-weight: 500;
            color: var(--pbi-text-secondary);
        }
        
        .filter-group select,
        .filter-group input {
            padding: 4px 8px;
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 10px;
            background: var(--pbi-background);
            color: var(--pbi-text);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .charts-row {
            display: -webkit-grid;
            display: grid;
            -webkit-grid-template-columns: repeat(2, 1fr);
            grid-template-columns: repeat(2, 1fr);
            -webkit-column-gap: 10px;
            -moz-column-gap: 10px;
            column-gap: 10px;
            -webkit-row-gap: 10px;
            -moz-row-gap: 10px;
            row-gap: 10px;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .chart-card {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            padding: 10px;
            -webkit-box-shadow: var(--pbi-shadow);
            -moz-box-shadow: var(--pbi-shadow);
            box-shadow: var(--pbi-shadow);
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .chart-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--pbi-text);
            margin-bottom: 6px;
        }
        
        .chart-container {
            height: 180px;
            position: relative;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .client-selector-top {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-justify-content: space-between;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            -webkit-box-shadow: var(--pbi-shadow);
            -moz-box-shadow: var(--pbi-shadow);
            box-shadow: var(--pbi-shadow);
        }
        
        .client-selector-top > div {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-column-gap: 12px;
            -moz-column-gap: 12px;
            column-gap: 12px;
            -webkit-row-gap: 12px;
            -moz-row-gap: 12px;
            row-gap: 12px;
            gap: 12px;
        }
        
        .client-selector-top label {
            font-size: 11px;
            font-weight: 500;
        }
        
        .client-selector-top select {
            padding: 6px 10px;
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font-size: 11px;
            background: var(--pbi-background);
            color: var(--pbi-text);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .client-selector-top #clientSelect {
            min-width: 250px;
        }
        
        .export-buttons-container {
            margin-left: auto;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-column-gap: 8px;
            -moz-column-gap: 8px;
            column-gap: 8px;
            -webkit-row-gap: 8px;
            -moz-row-gap: 8px;
            row-gap: 8px;
            gap: 8px;
            -webkit-flex-shrink: 0;
            -ms-flex-negative: 0;
            flex-shrink: 0;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
        }
        
        .export-button {
            padding: 6px 12px;
            background: var(--pbi-primary);
            color: white;
            border: none;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 500;
            -webkit-transition: background 0.15s ease;
            -moz-transition: background 0.15s ease;
            transition: background 0.15s ease;
            display: -webkit-inline-flex;
            display: -ms-inline-flexbox;
            display: inline-flex;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-column-gap: 4px;
            -moz-column-gap: 4px;
            column-gap: 4px;
            gap: 4px;
            white-space: nowrap;
        }
        
        .export-button:hover {
            background: var(--pbi-primary-dark);
        }
        
        .export-button.pdf {
            background: #d13438;
        }
        
        .export-button.pdf:hover {
            background: #a4262c;
        }
        
        .data-table-container {
            background: var(--pbi-card-bg);
            border: 1px solid var(--pbi-border);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            padding: 10px;
            -webkit-box-shadow: var(--pbi-shadow);
            -moz-box-shadow: var(--pbi-shadow);
            box-shadow: var(--pbi-shadow);
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .table-header {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-justify-content: space-between;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--pbi-border-light);
        }
        
        .table-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--pbi-text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table-scroll-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 400px;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .table-scroll-container.small {
            max-height: 300px;
        }
        
        .remittance-table {
            width: 100%;
            min-width: 1000px;
            table-layout: auto;
        }
        
        .reconciliation-grid {
            display: -webkit-grid;
            display: grid;
            -webkit-grid-template-columns: repeat(4, 1fr);
            grid-template-columns: repeat(4, 1fr);
            -webkit-column-gap: 12px;
            -moz-column-gap: 12px;
            column-gap: 12px;
            -webkit-row-gap: 12px;
            -moz-row-gap: 12px;
            row-gap: 12px;
            gap: 12px;
            margin-top: 8px;
        }
        
        .summary-section {
            margin-bottom: 12px;
        }
        
        .summary-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--pbi-text-primary);
            margin-bottom: 8px;
        }
        
        .summary-stat-label {
            font-size: 10px;
            color: var(--pbi-text-secondary);
            margin-bottom: 4px;
        }
        
        .summary-stat-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .period-selector {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-column-gap: 6px;
            -moz-column-gap: 6px;
            column-gap: 6px;
            -webkit-row-gap: 6px;
            -moz-row-gap: 6px;
            row-gap: 6px;
            gap: 6px;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
        }
        
        /* Chrome-specific fixes */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            .remittance-kpi-grid,
            .status-cards,
            .charts-row {
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
            }
            
            .status-card,
            .kpi-card,
            .chart-card {
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
                will-change: transform;
            }
        }
        
        /* Additional Safari-specific fixes */
        @supports (-webkit-appearance: none) {
            .remittance-table {
                -webkit-font-smoothing: antialiased;
            }
            
            .status-card-value {
                -webkit-font-smoothing: antialiased;
            }
        }
        
        /* Ensure consistent text rendering */
        .status-card-value,
        .kpi-value {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Fix for browsers that don't support gap property */
        @supports not (gap: 4px) {
            .remittance-tabs > * + * {
                margin-left: 4px;
            }
            
            .filter-bar > * + * {
                margin-left: 8px;
            }
            
            .filter-group > * + * {
                margin-left: 6px;
            }
            
            .client-selector-top > div > * + * {
                margin-left: 12px;
            }
            
            .period-selector > * + * {
                margin-left: 6px;
            }
            
            .export-buttons-container > * + * {
                margin-left: 8px;
            }
        }
        
        /* Force hardware acceleration for smoother rendering */
        /* Override main-container for this page - no sidebar */
        .main-container {
            -webkit-grid-template-columns: 1fr !important;
            grid-template-columns: 1fr !important;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            width: 100%;
            max-width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            padding: 12px;
        }
        
        .report-tab-content {
            width: 100%;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        /* Ensure body and html take full width */
        html, body {
            width: 100%;
            overflow-x: hidden;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        /* Ensure proper rendering of CSS variables in Chrome */
        .status-card,
        .kpi-card {
            background-color: var(--pbi-card-bg);
            border-color: var(--pbi-border);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">FRT Work Tools</div>
            <div class="header-title">Remittance</div>
        </div>
        <div class="header-right">
            <div class="user-info">Craig D'Alessio</div>
            <button>Share</button>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <button class="nav-tab">
            <i class="fas fa-file-check"></i>
            ELIGIBILITY & FILINGS
        </button>
        <button class="nav-tab">
            <i class="fas fa-chart-line"></i>
            STATUS REPORTS
        </button>
        <button class="nav-tab">
            <i class="fas fa-bell"></i>
            OPT-IN MONITORING
        </button>
        <button class="nav-tab active">
            <i class="fas fa-money-bill-wave"></i>
            REMITTANCE
        </button>
        <button class="nav-tab">
            <i class="fas fa-user-tie"></i>
            Account Manager Dashboard
        </button>
        <button class="nav-tab">
            <i class="fas fa-users"></i>
            My Portfolio
        </button>
        <button class="nav-tab">+</button>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Client Selector -->
        <div class="client-selector-top">
            <div>
                <label>Client:</label>
                <select id="clientSelect">
                    <option value="demo">DEMOFRTCLIENT</option>
                    <option value="wellington">Wellington Management</option>
                    <option value="blackrock">BlackRock</option>
                    <option value="schwab">Charles Schwab Investment Management</option>
                </select>
            </div>
            <div class="period-selector">
                <label>Period:</label>
                <select id="periodSelect">
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                    <option value="ytd">Year to Date</option>
                </select>
                <select id="monthSelect">
                    <option value="2024-10">October 2024</option>
                    <option value="2024-09">September 2024</option>
                    <option value="2024-08">August 2024</option>
                </select>
            </div>
        </div>

        <!-- Executive Summary KPIs -->
        <div class="remittance-kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Total Remitted (YTD)</div>
                <div class="kpi-value" id="kpiTotalRemitted">$2,499,756</div>
                <div class="kpi-change positive">
                    <span class="kpi-trend">↑</span>
                    <span>Year to Date</span>
                </div>
                <div class="kpi-subtitle">All Payments Received</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">This Period Remitted</div>
                <div class="kpi-value" id="kpiPeriodRemitted">$456,789</div>
                <div class="kpi-change positive">
                    <span class="kpi-trend">↑</span>
                    <span>Current Period</span>
                </div>
                <div class="kpi-subtitle" id="kpiPeriodLabel">October 2024</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Pending Remittances</div>
                <div class="kpi-value" id="kpiPendingRemittances">$1,123,456</div>
                <div class="kpi-change">
                    <span class="kpi-trend">→</span>
                    <span>Expected</span>
                </div>
                <div class="kpi-subtitle">Not Yet Received</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Reconciliation Rate</div>
                <div class="kpi-value" id="kpiReconciliationRate">94.2%</div>
                <div class="kpi-change positive">
                    <span class="kpi-trend">↑</span>
                    <span>Matched to Claims</span>
                </div>
                <div class="kpi-subtitle">Payment Matching</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Avg Days to Payment</div>
                <div class="kpi-value" id="kpiAvgDays">127</div>
                <div class="kpi-change">
                    <span class="kpi-trend">→</span>
                    <span>Days</span>
                </div>
                <div class="kpi-subtitle">Filing to Payment</div>
            </div>
        </div>

        <!-- Lifecycle Status Cards (client-friendly) -->
        <div class="status-cards">
            <div class="status-card payable">
                <div class="status-card-title">Payable (Ready to Pay)</div>
                <div class="status-card-value">$1,123,456</div>
                <div class="status-card-count">Lockbox funds ready for wiring</div>
            </div>
            <div class="status-card paid">
                <div class="status-card-title">Paid to Client</div>
                <div class="status-card-value">$2,499,756</div>
                <div class="status-card-count">342 payments wired</div>
            </div>
            <div class="status-card returned">
                <div class="status-card-title">Payment Returned</div>
                <div class="status-card-value">$125,000</div>
                <div class="status-card-count">3 payments requiring updated instructions</div>
            </div>
        </div>

        <!-- Remittance Tabs -->
        <div class="remittance-tabs">
            <button class="remittance-tab active" data-tab="recent">Recent Remittances</button>
            <button class="remittance-tab" data-tab="pending">Pending Remittances</button>
            <button class="remittance-tab" data-tab="reconciliation">Reconciliation</button>
            <button class="remittance-tab" data-tab="history">Payment History</button>
        </div>

        <!-- Recent Remittances Tab -->
        <div class="report-tab-content" id="recentTab">
            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="statusFilter">
                        <option value="all">All</option>
                        <option value="payable">Payable (Ready to Pay)</option>
                        <option value="paid">Paid</option>
                        <option value="payment-returned">Payment Returned</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Payment Method:</label>
                    <select id="methodFilter">
                        <option value="all">All</option>
                        <option value="wire">Wire</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Administrator:</label>
                    <select id="adminFilter">
                        <option value="all">All</option>
                        <option value="gland">Gland & Co</option>
                        <option value="garden">Garden City Group</option>
                        <option value="epiq">Epiq Systems</option>
                        <option value="abdata">A.B. Data, Ltd</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Date Range:</label>
                    <input type="date" id="dateFrom" class="date-input">
                    <span class="date-separator">to</span>
                    <input type="date" id="dateTo" class="date-input">
                </div>
                <div class="export-buttons-container">
                    <button class="export-button" onclick="exportRemittances('recent')">
                        <i class="fas fa-file-excel"></i> Export to Excel
                    </button>
                    <button class="export-button pdf" onclick="exportRemittancePDF()">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                </div>
            </div>

            <!-- Recent Remittances Table -->
            <div class="data-table-container">
                <div class="table-header">
                    <div class="table-title">Recent Remittances - This Period</div>
                </div>
                <div class="table-scroll-container">
                    <table class="remittance-table" id="recentRemittancesTable">
                        <thead>
                            <tr>
                                <th>Payment Date</th>
                                <th>Case Name</th>
                                <th>Settlement Fund</th>
                                <th>Gross Amount</th>
                                <th>FRT Fee</th>
                                <th>Net to Client</th>
                                <th>Method</th>
                                <th>Reference #</th>
                                <th>Administrator</th>
                                <th>Status</th>
                                <th>Reconciliation</th>
                            </tr>
                        </thead>
                        <tbody id="recentRemittancesTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pending Remittances Tab -->
        <div class="report-tab-content" id="pendingTab" style="display: none;">
            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="pendingStatusFilter">
                        <option value="all">All</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="delayed">Delayed</option>
                        <option value="overdue">Overdue</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Days Until:</label>
                    <select id="daysFilter">
                        <option value="all">All</option>
                        <option value="overdue">Overdue</option>
                        <option value="7">Next 7 Days</option>
                        <option value="30">Next 30 Days</option>
                        <option value="90">Next 90 Days</option>
                    </select>
                </div>
                <div class="export-buttons-container">
                    <button class="export-button" onclick="exportRemittances('pending')">
                        <i class="fas fa-file-excel"></i> Export to Excel
                    </button>
                </div>
            </div>

            <!-- Pending Remittances Table -->
            <div class="data-table-container">
                <div class="table-header">
                    <div class="table-title">Pending Remittances - Expected Payments</div>
                </div>
                <div class="table-scroll-container">
                    <table class="remittance-table" id="pendingRemittancesTable">
                        <thead>
                            <tr>
                                <th>Expected Date</th>
                                <th>Case Name</th>
                                <th>Settlement Fund</th>
                                <th>Expected Amount</th>
                                <th>Days Until</th>
                                <th>Administrator</th>
                                <th>Status</th>
                                <th>Last Update</th>
                            </tr>
                        </thead>
                        <tbody id="pendingRemittancesTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reconciliation Tab -->
        <div class="report-tab-content" id="reconciliationTab" style="display: none;">
            <!-- Reconciliation Summary -->
            <div class="summary-section">
                <div class="summary-title">Reconciliation Status</div>
                <div class="reconciliation-grid">
                    <div>
                        <div class="summary-stat-label">Total Payments</div>
                        <div class="summary-stat-value">342</div>
                    </div>
                    <div>
                        <div class="summary-stat-label">Matched</div>
                        <div class="summary-stat-value" style="color: #107c10;">322</div>
                    </div>
                    <div>
                        <div class="summary-stat-label">Unmatched</div>
                        <div class="summary-stat-value" style="color: #ffb900;">15</div>
                    </div>
                    <div>
                        <div class="summary-stat-label">Flagged</div>
                        <div class="summary-stat-value" style="color: #d13438;">5</div>
                    </div>
                </div>
            </div>

            <!-- Unmatched Payments -->
            <div class="data-table-container" style="margin-bottom: 12px;">
                <div class="table-header">
                    <div class="table-title">Unmatched Payments - Require Attention</div>
                </div>
                <div class="table-scroll-container small">
                    <table class="remittance-table" id="unmatchedTable">
                        <thead>
                            <tr>
                                <th>Payment Date</th>
                                <th>Reference #</th>
                                <th>Amount</th>
                                <th>Administrator</th>
                                <th>Suggested Match</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="unmatchedTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Missing Payments -->
            <div class="data-table-container">
                <div class="table-header">
                    <div class="table-title">Missing Payments - Expected But Not Received</div>
                </div>
                <div class="table-scroll-container small">
                    <table class="remittance-table" id="missingTable">
                        <thead>
                            <tr>
                                <th>Expected Date</th>
                                <th>Case Name</th>
                                <th>Expected Amount</th>
                                <th>Days Overdue</th>
                                <th>Administrator</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="missingTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Payment History Tab -->
        <div class="report-tab-content" id="historyTab" style="display: none;">
            <!-- Charts -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-title">Remittances by Month</div>
                    <div class="chart-container">
                        <canvas id="remittancesByMonthChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Payment Status Distribution</div>
                    <div class="chart-container">
                        <canvas id="paymentStatusChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-title">Average Payment Timeline by Case Type</div>
                    <div class="chart-container">
                        <canvas id="paymentTimelineChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Remittances by Administrator</div>
                    <div class="chart-container">
                        <canvas id="remittancesByAdminChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Payment History Table -->
            <div class="data-table-container">
                <div class="table-header">
                    <div class="table-title">Complete Payment History</div>
                    <div class="table-controls">
                        <button class="export-button" onclick="exportRemittances('history')">
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                    </div>
                </div>
                <div class="table-scroll-container">
                    <table class="remittance-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>Payment Date</th>
                                <th>Case Name</th>
                                <th>Gross Amount</th>
                                <th>Net to Client</th>
                                <th>Method</th>
                                <th>Administrator</th>
                                <th>Status</th>
                                <th>Days to Payment</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- FRT Footer -->
    <div class="frt-footer">
        <div class="frt-footer-top">
            <strong>FRT Financial Recovery Technologies LLC</strong> | 
            <a href="https://www.frtservices.com" target="_blank">www.frtservices.com</a> | 
            <a href="mailto:info@frtservices.com">info@frtservices.com</a>
        </div>
        <div class="frt-footer-bottom">
            This report is confidential and proprietary. Unauthorized distribution is prohibited.
        </div>
    </div>

    <!-- Style Switcher -->
    <div id="styleSwitcher"></div>
    <script src="style-switcher.js"></script>

    <script>
        // Mocked client/period scenarios (as if coming from backend)
        const remittanceScenarios = {
            demo: {
                '2024-10': {
                    periodLabel: 'October 2024',
                    kpis: {
                        totalRemittedYTD: '$2,499,756',
                        thisPeriodRemitted: '$456,789',
                        pendingRemittances: '$1,123,456',
                        reconciliationRate: '94.2%',
                        avgDaysToPayment: '127'
                    },
                    statusCards: {
                        payableAmount: '$1,123,456',
                        payableText: 'Lockbox funds ready for wiring',
                        paidAmount: '$2,499,756',
                        paidText: '342 payments wired',
                        returnedAmount: '$125,000',
                        returnedText: '3 payments requiring updated instructions'
                    },
                    statusBreakdown: {
                        paid: 2499756,
                        payable: 1123456,
                        returned: 125000
                    }
                },
                '2024-09': {
                    periodLabel: 'September 2024',
                    kpis: {
                        totalRemittedYTD: '$2,042,967',
                        thisPeriodRemitted: '$312,450',
                        pendingRemittances: '$890,120',
                        reconciliationRate: '92.8%',
                        avgDaysToPayment: '133'
                    },
                    statusCards: {
                        payableAmount: '$890,120',
                        payableText: 'Lockbox funds ready for wiring',
                        paidAmount: '$2,042,967',
                        paidText: '276 payments wired',
                        returnedAmount: '$75,000',
                        returnedText: '2 payments requiring updated instructions'
                    },
                    statusBreakdown: {
                        paid: 2042967,
                        payable: 890120,
                        returned: 75000
                    }
                }
            },
            wellington: {
                '2024-10': {
                    periodLabel: 'October 2024',
                    kpis: {
                        totalRemittedYTD: '$1,875,420',
                        thisPeriodRemitted: '$289,340',
                        pendingRemittances: '$642,900',
                        reconciliationRate: '95.6%',
                        avgDaysToPayment: '119'
                    },
                    statusCards: {
                        payableAmount: '$642,900',
                        payableText: 'Awaiting client wiring instructions',
                        paidAmount: '$1,875,420',
                        paidText: '198 payments wired',
                        returnedAmount: '$45,000',
                        returnedText: '1 payment requiring updated instructions'
                    },
                    statusBreakdown: {
                        paid: 1875420,
                        payable: 642900,
                        returned: 45000
                    }
                }
            }
        };

        let currentClientKey = 'demo';
        let currentMonthKey = '2024-10';

        function getCurrentScenario() {
            const clientScenarios = remittanceScenarios[currentClientKey] || remittanceScenarios.demo;
            return clientScenarios[currentMonthKey] || clientScenarios['2024-10'];
        }

        // Check for URL parameters
        function getClientFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('client') || null;
        }
        
        function getPeriodFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('period') || null;
        }

        function updateRemittanceView() {
            const scenario = getCurrentScenario();
            if (!scenario) return;

            // Update KPI cards
            const kpis = scenario.kpis;
            const statusCards = scenario.statusCards;

            const kpiTotalRemittedEl = document.getElementById('kpiTotalRemitted');
            const kpiPeriodRemittedEl = document.getElementById('kpiPeriodRemitted');
            const kpiPendingRemittancesEl = document.getElementById('kpiPendingRemittances');
            const kpiReconciliationRateEl = document.getElementById('kpiReconciliationRate');
            const kpiAvgDaysEl = document.getElementById('kpiAvgDays');
            const kpiPeriodLabelEl = document.getElementById('kpiPeriodLabel');

            if (kpiTotalRemittedEl) kpiTotalRemittedEl.textContent = kpis.totalRemittedYTD;
            if (kpiPeriodRemittedEl) kpiPeriodRemittedEl.textContent = kpis.thisPeriodRemitted;
            if (kpiPendingRemittancesEl) kpiPendingRemittancesEl.textContent = kpis.pendingRemittances;
            if (kpiReconciliationRateEl) kpiReconciliationRateEl.textContent = kpis.reconciliationRate;
            if (kpiAvgDaysEl) kpiAvgDaysEl.textContent = kpis.avgDaysToPayment;
            if (kpiPeriodLabelEl) kpiPeriodLabelEl.textContent = scenario.periodLabel;

            // Update lifecycle status cards
            const payableValueEl = document.querySelector('.status-card.payable .status-card-value');
            const payableTextEl = document.querySelector('.status-card.payable .status-card-count');
            const paidValueEl = document.querySelector('.status-card.paid .status-card-value');
            const paidTextEl = document.querySelector('.status-card.paid .status-card-count');
            const returnedValueEl = document.querySelector('.status-card.returned .status-card-value');
            const returnedTextEl = document.querySelector('.status-card.returned .status-card-count');

            if (payableValueEl) payableValueEl.textContent = statusCards.payableAmount;
            
            // Update tables with scenario data
            populateRecentRemittancesTable();
            populatePendingRemittancesTable();
            if (payableTextEl) payableTextEl.textContent = statusCards.payableText;
            if (paidValueEl) paidValueEl.textContent = statusCards.paidAmount;
            if (paidTextEl) paidTextEl.textContent = statusCards.paidText;
            if (returnedValueEl) returnedValueEl.textContent = statusCards.returnedAmount;
            if (returnedTextEl) returnedTextEl.textContent = statusCards.returnedText;

            // Update payment status chart to reflect new breakdown
            createPaymentStatusChart();
        }

        // Sample remittance data for the default scenario (demo / October 2024)
        const recentRemittancesData = [
            // Paid wires to clients
            { paymentDate: '10-25-2024', caseName: 'TESLA INC', settlementFund: '$195,000,000.00', grossAmount: '$34,567.89', fee: '$345.68', net: '$34,222.21', method: 'Wire', reference: 'WIRE-2024-1025-001', admin: 'Gland & Co', status: 'Paid', reconciliation: 'Matched' },
            { paymentDate: '10-26-2024', caseName: 'META PLATFORMS', settlementFund: '$310,000,000.00', grossAmount: '$67,890.12', fee: '$678.90', net: '$67,211.22', method: 'Wire', reference: 'WIRE-2024-1026-002', admin: 'Garden City Group', status: 'Paid', reconciliation: 'Matched' },
            { paymentDate: '10-28-2024', caseName: 'BANK OF AMERICA', settlementFund: '$225,000,000.00', grossAmount: '$45,678.90', fee: '$456.79', net: '$45,222.11', method: 'Wire', reference: 'WIRE-2024-1028-004', admin: 'A.B. Data, Ltd', status: 'Paid', reconciliation: 'Matched' },
            { paymentDate: '11-01-2024', caseName: 'CITIGROUP INC', settlementFund: '$155,000,000.00', grossAmount: '$27,654.32', fee: '$276.54', net: '$27,377.78', method: 'Wire', reference: 'WIRE-2024-1101-008', admin: 'A.B. Data, Ltd', status: 'Paid', reconciliation: 'Matched' },
            { paymentDate: '11-03-2024', caseName: 'JOHNSON & JOHNSON', settlementFund: '$220,000,000.00', grossAmount: '$43,567.89', fee: '$435.68', net: '$43,132.21', method: 'Wire', reference: 'WIRE-2024-1103-010', admin: 'Garden City Group', status: 'Paid', reconciliation: 'Flagged' },
            
            // Payable items – cash in lockbox, not yet wired
            { paymentDate: '10-27-2024', caseName: 'NVIDIA CORP', settlementFund: '$175,000,000.00', grossAmount: '$23,456.78', fee: '$234.57', net: '$23,222.21', method: 'Wire', reference: 'WIRE-2024-1027-003', admin: 'Epiq Systems', status: 'Payable', reconciliation: 'Unmatched' },
            { paymentDate: '10-30-2024', caseName: 'GOLDMAN SACHS', settlementFund: '$265,000,000.00', grossAmount: '$52,345.67', fee: '$523.46', net: '$51,822.21', method: 'Wire', reference: 'WIRE-2024-1030-006', admin: 'Garden City Group', status: 'Payable', reconciliation: 'Pending' },
            
            // Returned wires needing attention
            { paymentDate: '10-31-2024', caseName: 'MORGAN STANLEY', settlementFund: '$190,000,000.00', grossAmount: '$38,901.23', fee: '$389.01', net: '$38,512.22', method: 'Wire', reference: 'WIRE-2024-1031-007', admin: 'Epiq Systems', status: 'Payment Returned', reconciliation: 'Unmatched' },
            { paymentDate: '11-02-2024', caseName: 'BERKSHIRE HATHAWAY', settlementFund: '$380,000,000.00', grossAmount: '$71,234.56', fee: '$712.35', net: '$70,522.21', method: 'Wire', reference: 'WIRE-2024-1102-009', admin: 'Gland & Co', status: 'Payment Returned', reconciliation: 'Pending' }
        ];

        const pendingRemittancesData = [
            { expectedDate: '11-15-2024', caseName: 'APPLE INC', settlementFund: '$490,000,000.00', expectedAmount: '$45,230.12', daysUntil: 12, admin: 'Gland & Co', status: 'Scheduled', lastUpdate: '10-20-2024' },
            { expectedDate: '11-20-2024', caseName: 'MICROSOFT CORP', settlementFund: '$350,000,000.00', expectedAmount: '$78,945.23', daysUntil: 17, admin: 'Garden City Group', status: 'Confirmed', lastUpdate: '10-22-2024' },
            { expectedDate: '11-25-2024', caseName: 'AMAZON.COM INC', settlementFund: '$280,000,000.00', expectedAmount: '$56,789.45', daysUntil: 22, admin: 'Epiq Systems', status: 'Scheduled', lastUpdate: '10-23-2024' },
            { expectedDate: '12-01-2024', caseName: 'ALPHABET INC', settlementFund: '$420,000,000.00', expectedAmount: '$89,123.67', daysUntil: 28, admin: 'A.B. Data, Ltd', status: 'Confirmed', lastUpdate: '10-24-2024' },
            { expectedDate: '10-15-2024', caseName: 'APACHE CORP', settlementFund: '$65,000,000.00', expectedAmount: '$1,065.95', daysUntil: -18, admin: 'A.B. Data, Ltd', status: 'Overdue', lastUpdate: '09-30-2024' },
            { expectedDate: '10-20-2024', caseName: 'JPMORGAN', settlementFund: '$150,000,000.00', expectedAmount: '$12,456.78', daysUntil: -13, admin: 'Epiq Systems', status: 'Overdue', lastUpdate: '10-05-2024' }
        ];

        const unmatchedPaymentsData = [
            { paymentDate: '10-27-2024', reference: 'CHK-2024-1027-003', amount: '$23,456.78', admin: 'Epiq Systems', suggestedMatch: 'NVIDIA CORP - Claim #4680' },
            { paymentDate: '11-05-2024', reference: 'WIRE-2024-1105-011', amount: '$15,234.56', admin: 'Gland & Co', suggestedMatch: 'Unknown - Manual Review Required' },
            { paymentDate: '11-06-2024', reference: 'ACH-2024-1106-012', amount: '$8,901.23', admin: 'Garden City Group', suggestedMatch: 'Multiple Possible Matches' }
        ];

        const missingPaymentsData = [
            { expectedDate: '10-15-2024', caseName: 'APACHE CORP', expectedAmount: '$1,065.95', daysOverdue: 18, admin: 'A.B. Data, Ltd' },
            { expectedDate: '10-20-2024', caseName: 'JPMORGAN', expectedAmount: '$12,456.78', daysOverdue: 13, admin: 'Epiq Systems' },
            { expectedDate: '10-18-2024', caseName: 'PROCTER & GAMBLE', expectedAmount: '$31,789.01', daysOverdue: 15, admin: 'Epiq Systems' }
        ];

        // Tab switching
        document.querySelectorAll('.remittance-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                
                // Update tab active state
                document.querySelectorAll('.remittance-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide tab content
                document.querySelectorAll('.report-tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById(tabName + 'Tab').style.display = 'block';
            });
        });

        // Helper function to create case name links
        function getCaseLink(caseName) {
            const caseLinks = {
                'APPLE INC': 'case-apple-inc-securities.html',
                'ALPHABET INC': 'case-alphabet-inc.html',
                'Foreign Exchange Antitrust': 'case-foreign-exchange-antitrust.html',
                'Atos SE': 'case-atos-se.html',
                'Barclays Plc': 'case-barclays-plc.html',
                'Grab Holdings': 'case-grab-holdings.html',
                'GRAB HOLDINGS LIMITED': 'case-grab-holdings.html',
                'Eagle Bancorp': 'case-eagle-bancorp-fair-fund.html',
                'EAGLE BANCORP INC Fair Fund': 'case-eagle-bancorp-fair-fund.html'
            };
            const url = caseLinks[caseName];
            if (url) {
                return `<a href="${url}" style="color: var(--pbi-primary); text-decoration: none; font-weight: 500;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">${caseName}</a>`;
            }
            return caseName;
        }
        
        // Populate Recent Remittances Table
        // Get current client and period from selectors
        function getCurrentClientKey() {
            const clientSelect = document.getElementById('clientSelect');
            return clientSelect ? clientSelect.value : 'demo';
        }
        
        function getCurrentPeriodKey() {
            const monthSelect = document.getElementById('monthSelect');
            return monthSelect ? monthSelect.value : '2024-10';
        }
        
        function populateRecentRemittancesTable() {
            const tbody = document.getElementById('recentRemittancesTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';
            
            const clientKey = getCurrentClientKey();
            const periodKey = getCurrentPeriodKey();
            const scenario = remittanceScenarios[clientKey] && remittanceScenarios[clientKey][periodKey];
            
            // Use scenario data if available, otherwise fall back to static data
            const dataToUse = scenario && scenario.recentRemittances ? scenario.recentRemittances : recentRemittancesData;
            
            dataToUse.forEach(row => {
                const tr = document.createElement('tr');
                const statusClass = row.status.toLowerCase().replace(' ', '-');
                const reconClass = row.reconciliation.toLowerCase();
                
                tr.innerHTML = `
                    <td class="date-cell">${row.paymentDate}</td>
                    <td>${getCaseLink(row.caseName)}</td>
                    <td class="currency-cell">${row.settlementFund}</td>
                    <td class="currency-cell">${row.grossAmount}</td>
                    <td class="currency-cell">${row.fee}</td>
                    <td class="currency-cell">${row.net}</td>
                    <td><span class="payment-method-badge">${row.method}</span></td>
                    <td style="font-family: 'Courier New', monospace; font-size: 8px;">${row.reference}</td>
                    <td>${row.admin}</td>
                    <td><span class="payment-status-badge status-${statusClass}">${row.status}</span></td>
                    <td><span class="reconciliation-status recon-${reconClass}">${row.reconciliation}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Populate Pending Remittances Table
        function populatePendingRemittancesTable() {
            const tbody = document.getElementById('pendingRemittancesTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';
            
            const clientKey = getCurrentClientKey();
            const periodKey = getCurrentPeriodKey();
            const scenario = remittanceScenarios[clientKey] && remittanceScenarios[clientKey][periodKey];
            
            // Use scenario data if available, otherwise fall back to static data
            const dataToUse = scenario && scenario.pendingRemittances ? scenario.pendingRemittances : pendingRemittancesData;
            
            dataToUse.forEach(row => {
                const tr = document.createElement('tr');
                let daysClass = 'days-normal';
                let daysText = `${row.daysUntil} days`;
                
                if (row.daysUntil < 0) {
                    daysClass = 'days-overdue';
                    daysText = `OVERDUE (${Math.abs(row.daysUntil)} days)`;
                } else if (row.daysUntil <= 7) {
                    daysClass = 'days-approaching';
                }
                
                tr.innerHTML = `
                    <td class="date-cell">${row.expectedDate}</td>
                    <td>${getCaseLink(row.caseName)}</td>
                    <td class="currency-cell">${row.settlementFund}</td>
                    <td class="currency-cell">${row.expectedAmount}</td>
                    <td><span class="days-indicator ${daysClass}">${daysText}</span></td>
                    <td>${row.admin}</td>
                    <td><span class="payment-status-badge status-${row.status.toLowerCase()}">${row.status}</span></td>
                    <td class="date-cell">${row.lastUpdate}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Populate Unmatched Payments Table
        function populateUnmatchedTable() {
            const tbody = document.getElementById('unmatchedTableBody');
            tbody.innerHTML = '';
            
            unmatchedPaymentsData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="date-cell">${row.paymentDate}</td>
                    <td style="font-family: 'Courier New', monospace; font-size: 8px;">${row.reference}</td>
                    <td class="currency-cell">${row.amount}</td>
                    <td>${row.admin}</td>
                    <td style="font-size: 8px; color: var(--pbi-text-secondary);">${row.suggestedMatch}</td>
                    <td>
                        <button class="export-button" style="padding: 2px 8px; font-size: 8px;" onclick="matchPayment('${row.reference}')">
                            <i class="fas fa-link"></i> Match
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Populate Missing Payments Table
        function populateMissingTable() {
            const tbody = document.getElementById('missingTableBody');
            tbody.innerHTML = '';
            
            missingPaymentsData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="date-cell">${row.expectedDate}</td>
                    <td>${getCaseLink(row.caseName)}</td>
                    <td class="currency-cell">${row.expectedAmount}</td>
                    <td><span class="days-indicator days-overdue">${row.daysOverdue} days</span></td>
                    <td>${row.admin}</td>
                    <td>
                        <button class="export-button" style="padding: 2px 8px; font-size: 8px;" onclick="followUpPayment('${row.caseName}')">
                            <i class="fas fa-envelope"></i> Follow Up
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Populate History Table
        function populateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            // Combine recent and add some historical data
            const allPayments = [...recentRemittancesData, ...recentRemittancesData.map((r, i) => ({
                ...r,
                paymentDate: `09-${25 + i}-2024`,
                daysToPayment: 120 + (i * 5)
            }))];
            
            allPayments.forEach(row => {
                const tr = document.createElement('tr');
                const statusClass = row.status.toLowerCase().replace(' ', '-');
                tr.innerHTML = `
                    <td class="date-cell">${row.paymentDate}</td>
                    <td>${getCaseLink(row.caseName)}</td>
                    <td class="currency-cell">${row.grossAmount}</td>
                    <td class="currency-cell">${row.net}</td>
                    <td><span class="payment-method-badge">${row.method}</span></td>
                    <td>${row.admin}</td>
                    <td><span class="payment-status-badge status-${statusClass}">${row.status}</span></td>
                    <td class="number-cell">${row.daysToPayment || 127}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Chart creation functions
        function createRemittancesByMonthChart() {
            const canvas = document.getElementById('remittancesByMonthChart');
            if (!canvas || typeof Chart === 'undefined') return;
            
            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
                    datasets: [{
                        label: 'Remittances ($)',
                        data: [0, 0, 145000, 0, 0, 783416, 0, 180750, 0, 456789],
                        backgroundColor: 'rgba(16, 124, 16, 0.8)',
                        borderColor: '#107c10',
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                },
                                font: { size: 9 }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            ticks: { font: { size: 9 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        let paymentStatusChartInstance = null;

        function createPaymentStatusChart() {
            const canvas = document.getElementById('paymentStatusChart');
            if (!canvas || typeof Chart === 'undefined') return;
            
            const scenario = getCurrentScenario();
            if (!scenario || !scenario.statusBreakdown) return;
            
            const breakdown = scenario.statusBreakdown;
            const dataValues = [breakdown.paid, breakdown.payable, breakdown.returned];

            const ctx = canvas.getContext('2d');
            
            if (paymentStatusChartInstance) {
                paymentStatusChartInstance.data.datasets[0].data = dataValues;
                paymentStatusChartInstance.update();
                return;
            }

            paymentStatusChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Paid', 'Payable', 'Payment Returned'],
                    datasets: [{
                        data: dataValues,
                        backgroundColor: [
                            'rgba(0, 120, 212, 0.8)',   // Paid
                            'rgba(16, 124, 16, 0.8)',   // Payable
                            'rgba(209, 52, 56, 0.8)'    // Payment Returned
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 9 }, padding: 8 }
                        }
                    }
                }
            });
        }

        function createPaymentTimelineChart() {
            const canvas = document.getElementById('paymentTimelineChart');
            if (!canvas || typeof Chart === 'undefined') return;
            
            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Settled Action', 'Antitrust', 'Non-US'],
                    datasets: [{
                        label: 'Avg Days to Payment',
                        data: [127, 145, 98],
                        backgroundColor: 'rgba(0, 120, 212, 0.8)',
                        borderColor: '#0078d4',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' days';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + ' days';
                                },
                                font: { size: 9 }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            ticks: { font: { size: 9 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function createRemittancesByAdminChart() {
            const canvas = document.getElementById('remittancesByAdminChart');
            if (!canvas || typeof Chart === 'undefined') return;
            
            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Gland & Co', 'Garden City', 'Epiq Systems', 'A.B. Data'],
                    datasets: [{
                        label: 'Total Remitted',
                        data: [856234, 1234567, 456789, 234567],
                        backgroundColor: 'rgba(0, 120, 212, 0.8)',
                        borderColor: '#0078d4',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.x.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                },
                                font: { size: 9 }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        y: {
                            ticks: { font: { size: 9 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // Export functions
        function exportRemittances(type) {
            let tableId;
            let filename;
            
            switch(type) {
                case 'recent':
                    tableId = 'recentRemittancesTable';
                    filename = 'Recent_Remittances';
                    break;
                case 'pending':
                    tableId = 'pendingRemittancesTable';
                    filename = 'Pending_Remittances';
                    break;
                case 'history':
                    tableId = 'historyTable';
                    filename = 'Payment_History';
                    break;
            }
            
            const table = document.getElementById(tableId);
            if (!table) return;
            
            let csv = [];
            csv.push('FRT FINANCIAL RECOVERY TECHNOLOGIES LLC');
            csv.push('Remittance Report - ' + document.getElementById('clientSelect').options[document.getElementById('clientSelect').selectedIndex].text);
            csv.push('Generated: ' + new Date().toLocaleDateString());
            csv.push('');
            
            const rows = table.querySelectorAll('tr');
            for (let i = 0; i < rows.length; i++) {
                const row = [];
                const cols = rows[i].querySelectorAll('td, th');
                for (let j = 0; j < cols.length; j++) {
                    let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/"/g, '""');
                    row.push('"' + data + '"');
                }
                csv.push(row.join(','));
            }
            
            csv.push('');
            csv.push('This report is confidential and proprietary.');
            
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename + '_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportRemittancePDF() {
            alert('PDF export functionality coming soon!');
        }

        function matchPayment(reference) {
            alert('Payment matching functionality: ' + reference);
        }

        function followUpPayment(caseName) {
            alert('Follow-up functionality for: ' + caseName);
        }

        // Tab navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                if (this.textContent.includes('ELIGIBILITY & FILINGS')) {
                    window.location.href = 'eligibility-filings.html';
                } else if (this.textContent.includes('STATUS REPORTS')) {
                    window.location.href = 'client-status-reports.html';
                } else if (this.textContent.includes('OPT-IN MONITORING')) {
                    window.location.href = 'opt-in-monitoring.html';
                } else if (this.textContent.includes('Account Manager Dashboard')) {
                    window.location.href = 'account-manager-dashboard.html';
                } else if (this.textContent.includes('My Portfolio')) {
                    window.location.href = 'account-manager-portfolio.html';
                } else {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            const clientSelect = document.getElementById('clientSelect');
            const monthSelect = document.getElementById('monthSelect');
            const periodSelect = document.getElementById('periodSelect');

            if (clientSelect) {
                clientSelect.addEventListener('change', () => {
                    currentClientKey = clientSelect.value || 'demo';
                    // Update URL without reload
                    const newURL = window.location.pathname + '?client=' + currentClientKey + (currentMonthKey ? '&period=' + currentMonthKey : '');
                    window.history.pushState({ client: currentClientKey, period: currentMonthKey }, '', newURL);
                    updateRemittanceView();
                });
            }

            if (monthSelect) {
                monthSelect.addEventListener('change', () => {
                    currentMonthKey = monthSelect.value || '2024-10';
                    // Update URL without reload
                    const currentClient = clientSelect ? clientSelect.value : 'demo';
                    const newURL = window.location.pathname + '?client=' + currentClient + '&period=' + currentMonthKey;
                    window.history.pushState({ client: currentClient, period: currentMonthKey }, '', newURL);
                    updateRemittanceView();
                });
            }

            if (periodSelect) {
                periodSelect.addEventListener('change', () => {
                    // For this mock, period type just changes the label;
                    // the scenario mapping stays keyed by month.
                    updateRemittanceView();
                });
            }

            // Check for URL parameters and set selectors
            const urlClient = getClientFromURL();
            const urlPeriod = getPeriodFromURL();
            if (urlClient && clientSelect) {
                clientSelect.value = urlClient;
            }
            if (urlPeriod && monthSelect) {
                monthSelect.value = urlPeriod;
            }
            
            // Initial data bind
            updateRemittanceView();
            populateUnmatchedTable();
            populateMissingTable();
            populateHistoryTable();
            
            setTimeout(() => {
                createRemittancesByMonthChart();
                createPaymentStatusChart();
                createPaymentTimelineChart();
                createRemittancesByAdminChart();
            }, 500);
        });
    </script>
</body>
</html>

